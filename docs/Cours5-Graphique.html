<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Viviane Pons" />
  <title>Programmation Orientée Objet – Java</title>
  <style type="text/css">
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" type="text/css" media="screen, projection, print"
    href="https://www.w3.org/Talks/Tools/Slidy2/styles/slidy.css" />
  <link rel="stylesheet" type="text/css" media="screen, projection, print"
   href="slidy/custom.css" />
  <script src="https://www.w3.org/Talks/Tools/Slidy2/scripts/slidy.js"
    charset="utf-8" type="text/javascript"></script>
</head>
<body>
<div class="slide titlepage">
  <h1 class="title">Programmation Orientée Objet – Java</h1>
  <p class="subtitle">Cours 5 : Applications graphiques et design MVC</p>
  <p class="author">
Viviane Pons
  </p>
  <p class="date">Master BIBS Université Paris-Saclay</p>
</div>
<div id="comment-créer-une-interface-graphique" class="slide section level1">
<h1>Comment créer une interface graphique ?</h1>
<p>Une interface graphique est un système de communication avec l’utilisateur final utilisant un affichage dans une fenêtre et réagissant aux actions de l’utilisateur tels que les clics et le clavier.</p>
<p>Côté programmation, cela demande d’interagir avec le système d’exploitation qui gère les différentes applications et les actions de l’utilisateur.</p>
<p>Java offre plusieurs bibliothèques :</p>
<ul>
<li><p>la bibliothèque historique <code>AWT</code> pour “Abstract Window Toolkit” : interfaçage bas niveau avec le système d’exploitation</p></li>
<li><p>la bibliothèque <code>Swing</code> : plus indépendante du système d’exploitation mais qui réutilise de nombreux composants <code>awt</code> – encore très classique même si un peu ancienne</p></li>
<li><p>la bibliothèque <code>JavaFX</code> : plus récente , architecture plus moderne et plus adaptée aux nouveaux supports (écrans tactiles par exemple). Nouvelle bibliothèque par défaut</p></li>
</ul>
<p>Cette année, on travaille avec le classique <code>Swing</code> car : encore très utilisé et distribué plus largement.</p>
</div>
<div class="slide section level1">

<h2 id="premier-exemple">Premier exemple</h2>
<p>“Hello World” <code>Swing</code></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="bu">JFrame</span> fenetre = <span class="kw">new</span> <span class="bu">JFrame</span>();</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>fenetre.<span class="fu">setTitle</span>(<span class="st">&quot;Première fenêtre en java&quot;</span>);</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a>fenetre.<span class="fu">setBounds</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">300</span>,<span class="dv">100</span>); </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>fenetre.<span class="fu">setDefaultCloseOperation</span>(<span class="bu">JFrame</span>.<span class="fu">EXIT_ON_CLOSE</span>);</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a><span class="bu">JPanel</span> panel = <span class="kw">new</span> <span class="bu">JPanel</span>();</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a><span class="bu">JLabel</span> helloWorld = <span class="kw">new</span> <span class="bu">JLabel</span>(<span class="st">&quot;Hello World !&quot;</span>);</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a>panel.<span class="fu">add</span>(helloWorld);</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a>fenetre.<span class="fu">getContentPane</span>().<span class="fu">add</span>(panel);</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a>fenetre.<span class="fu">setVisible</span>(<span class="kw">true</span>);</span></code></pre></div>
</div>
<div class="slide section level1">

<p>Ajout d’un bouton</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="bu">JFrame</span> fenetre = <span class="kw">new</span> <span class="bu">JFrame</span>();</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>fenetre.<span class="fu">setTitle</span>(<span class="st">&quot;Première fenêtre en java&quot;</span>);</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>fenetre.<span class="fu">setBounds</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">300</span>,<span class="dv">100</span>); </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>fenetre.<span class="fu">setDefaultCloseOperation</span>(<span class="bu">JFrame</span>.<span class="fu">EXIT_ON_CLOSE</span>);</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a><span class="bu">JPanel</span> panel = <span class="kw">new</span> <span class="bu">JPanel</span>();</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a><span class="bu">JLabel</span> helloWorld = <span class="kw">new</span> <span class="bu">JLabel</span>(<span class="st">&quot;Hello World !&quot;</span>);</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a><span class="bu">JButton</span> bouton = <span class="kw">new</span> <span class="bu">JButton</span>(<span class="st">&quot;Je suis un bouton&quot;</span>);</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a>panel.<span class="fu">add</span>(helloWorld);</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a>panel.<span class="fu">add</span>(bouton);</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a>fenetre.<span class="fu">getContentPane</span>().<span class="fu">add</span>(panel);</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a>fenetre.<span class="fu">setVisible</span>(<span class="kw">true</span>);</span></code></pre></div>
<p>Et ensuite ? Comment faire pour gérer le clic sur le bouton ? Plus généralement, comment lier l’interface graphique au reste du programme ?</p>
</div>
<div id="un-peu-de-design-pattern-larchitecture-modèle-vue-contrôleur" class="slide section level1">
<h1>Un peu de <em>design pattern</em> : l’architecture <em>Modèle-Vue-Contrôleur</em></h1>
<p>Qu’est-ce que les <em>design patterns</em> ? Ou <em>patrons de conception</em> en français : ce sont des <strong>solutions à des problèmes</strong></p>
<ul>
<li>Solutions considérées comme des “bonnes pratiques”</li>
<li>Architectures classiques que l’on va retrouver dans de nombreux programmes quel que soit le langage utilisé</li>
<li>Pour résoudre des problèmes courants (par exemple : la conception d’une interface graphique)</li>
</ul>
</div>
<div class="slide section level1">

<h2 id="le-mvc">Le MVC</h2>
<p>Pour Modèle-Vue-Contrôleur ou en anglais Model-View-Controller</p>
<ul>
<li>le problème : la conception d’interface graphique</li>
<li>solution datant de la fin des années 70 avec le développement des premières interfaces graphiques <code>GUI</code> en anglais pour “Graphical User Interface”</li>
<li>a BEAUCOUP évolué, peut s’interpréter de différentes façons et se retrouve à peu près partout sous différentes formes, en particulier dans le développement web et la plupart des <code>framework</code> associés</li>
</ul>
</div>
<div class="slide section level1">

<h2 id="lidée-générale">L’idée générale</h2>
<p>Organiser son architecture et son code en séparant trois rôles :</p>
<ul>
<li>le <strong>modèle</strong> : la logique interne du programme, la gestion des données, les calculs, etc.</li>
<li>la <strong>vue</strong> : l’affichage pour l’utilisateur final, tous les aspects graphiques</li>
<li>le <strong>contrôleur</strong> : la gestion des évènements graphiques lancés par l’utilisateur et le lien entre la vue et le modèle.</li>
</ul>
<p>Pourquoi ? Organisation, modularité, maintenabilité, séparation des compétences et expertises</p>
</div>
<div id="la-preuve-par-lexemple" class="slide section level1">
<h1>La preuve par l’exemple</h1>
<p>Nous allons concevoir une petite application graphique en suivant ce modèle. Cela nous permettra de voir :</p>
<ul>
<li>le fonctionnement général des interfaces <code>Swing</code></li>
<li>comment le design MVC est intégré à <code>Swing</code></li>
<li>un exemple d’architecture MVC basé sur <code>Swing</code></li>
</ul>
<p>Le code final de l’application exemple est <a href="https://github.com/VivianePons/JavaBIBS/tree/main/code/ExempleMVC">disponible ici</a>.</p>
</div>
<div class="slide section level1">

<h2 id="le-modèle">Le modèle</h2>
<p>Le but de l’application est de contrôler le dessin d’un rectangle dans une fenêtre. Le modèle ici est une classe qui représente le rectangle.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> <span class="bu">Rectangle</span> {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a>    </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a>    <span class="kw">public</span> <span class="bu">Rectangle</span>(<span class="dt">int</span> x, <span class="dt">int</span> y, <span class="dt">int</span> width, <span class="dt">int</span> height) {</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a>        <span class="kw">this</span>.<span class="fu">x</span> = x;</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a>        <span class="kw">this</span>.<span class="fu">y</span> = y;</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a>        <span class="kw">this</span>.<span class="fu">width</span> = width;</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a>        <span class="kw">this</span>.<span class="fu">height</span> = height;</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a>    }</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a>    </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true"></a>    ...</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<p>Cette classe contient des champs pour contrôler la position et la taille du rectangle à l’intérieur d’une plus grande boite (gérée avec des paramètres statiques).</p>
<p>Elle contient aussi des méthodes pour déplacer et redimensionner le rectangle tout en vérifiant qu’on reste dans la grande boite.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">trymove</span>(<span class="dt">int</span> diffx, <span class="dt">int</span> diffy) {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a>        <span class="dt">int</span> x = <span class="kw">this</span>.<span class="fu">x</span>;</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>        <span class="dt">int</span> y = <span class="kw">this</span>.<span class="fu">y</span>;</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a>        <span class="kw">this</span>.<span class="fu">x</span> += diffx;</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a>        <span class="kw">this</span>.<span class="fu">y</span> += diffy;</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a>        <span class="kw">if</span>(!<span class="fu">insideBounds</span>()) {</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a>            <span class="kw">this</span>.<span class="fu">x</span> = x;</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a>            <span class="kw">this</span>.<span class="fu">y</span> = y;</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a>            <span class="kw">return</span> <span class="kw">false</span>;</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a>        }</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true"></a>        <span class="kw">return</span> <span class="kw">true</span>;</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true"></a>    }</span></code></pre></div>
</div>
<div class="slide section level1">

<p><strong>Important</strong> : en aucun cas, le modèle ne doit dépendre de l’interface graphique, ni du contrôleur. Il est entièrement indépendant. C’est ce qui assure la modularité : on peut conserver le modèle tel quel si on change d’interface graphique. On peut d’ailleurs avoir plusieurs interfaces graphiques pour un seul modèle.</p>
</div>
<div class="slide section level1">

<h2 id="un-début-dinterface-graphique-pour-notre-modèle">Un début d’interface graphique pour notre modèle</h2>
<h3 id="création-de-linterface">Création de l’interface</h3>
<p>L’objectif est maintenant de construire la “vue” et le “contrôleur” qui vont correspondre à ce modèle.</p>
<p>Pour la vue, on commencer par créer une interface <code>RectangleAppView</code> qui va lister les méthodes spécifiques dont on aura besoin. Cela va permettre de séparer ce qui correspond à <em>notre</em> architecture spécifique et ce qui vient des éléments <code>Swing</code>. On garde ainsi un code plus modulaire.</p>
</div>
<div class="slide section level1">

<div class="sourceCode" id="cb5"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">interface</span> RectangleAppView {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a>    <span class="dt">void</span> <span class="fu">initialize</span>();</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a>    </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a>    <span class="dt">void</span> <span class="fu">setRectangle</span>(<span class="bu">Rectangle</span> rectangle);</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a>        </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a>}</span></code></pre></div>
<p>Pour l’instant, l’interface ne contient que 2 méthodes : on l’enrichira au fur et à mesure.</p>
<ul>
<li>l’initialisation : va permettre de lancer l’application</li>
<li>une méthode pour que la vue puisse “voir” le modèle et savoir quoi dessiner.</li>
</ul>
<p>Note : la vue ne doit que “voir” le modèle, elle ne doit pas directement le modifier (ça c’est le rôle du controleur). Pour une meilleure encapsulation, on pourrait donc lui passer seulement un objet qui est capable de “lire” les données mais pas d’écrire.</p>
</div>
<div class="slide section level1">

<h3 id="création-de-la-classe-rectangleappframe">Création de la classe <code>RectangleAppFrame</code></h3>
<p>On va maintenant créer les vrais classes qui vont implémenter notre vue. La classe de la fenêtre principale hérite de <code>JFrame</code> et implémente notre interface.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> RectangleAppFrame <span class="kw">extends</span> <span class="bu">JFrame</span> <span class="kw">implements</span> RectangleAppView {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a>    </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a>    ...</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<p>Que mettre dans cette classe ?</p>
<p>Un constructeur :</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="kw">public</span> <span class="fu">RectangleAppFrame</span>(<span class="bu">String</span> name, <span class="dt">int</span> boundx, <span class="dt">int</span> boundy) {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a>    <span class="kw">super</span>();</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a>    <span class="fu">setTitle</span>(name);</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a>    <span class="fu">setDefaultCloseOperation</span>(<span class="bu">JFrame</span>.<span class="fu">EXIT_ON_CLOSE</span>);</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true"></a>    <span class="kw">this</span>.<span class="fu">setResizable</span>(<span class="kw">false</span>);</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true"></a>    ...</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<h3 id="les-panneaux-jpanel">Les panneaux <code>JPanel</code></h3>
<p>Soit à la création, soit à l’initialisation, il faut créer les composants graphiques.</p>
<p>Une fenêtre <code>Swing</code> est organisée en “panneaux” (classe <code>JPanel</code>). Ces panneaux peuvent contenir d’autres panneaux ainsi que des composants type boutons, texte, etc.</p>
<p>Ici, on va créer deux panneaux : un pour les boutons et les options et un pour dessiner le rectangle.</p>
<p>Le panneau de dessin du rectangle aura des besoins graphiques spécifiques, on va créer une classe qui hérite de <code>JPanel</code>.</p>
</div>
<div class="slide section level1">

<h3 id="la-classe-rectanglepanel">La classe <code>RectanglePanel</code></h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> RectanglePanel <span class="kw">extends</span> <span class="bu">JPanel</span> {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a>    </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a>    <span class="kw">private</span> <span class="bu">Rectangle</span> rectangle;</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true"></a>    <span class="kw">public</span> <span class="fu">RectanglePanel</span>(<span class="dt">int</span> width, <span class="dt">int</span> height) {</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true"></a>        <span class="kw">super</span>();</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true"></a>        <span class="fu">setPreferredSize</span>(<span class="kw">new</span> <span class="bu">Dimension</span>(width, height));</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true"></a>        <span class="fu">setBackground</span>(<span class="bu">Color</span>.<span class="fu">WHITE</span>);</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true"></a>    }</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true"></a>    ...</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true"></a>} </span></code></pre></div>
<p>C’est le panneau du rectangle qui a besoin de voir le modèle donc c’est lui qui stocke le rectangle. A la création, on lui donne la bonne dimension et on passe sa couleur de fond à blanc.</p>
</div>
<div class="slide section level1">

<h3 id="création-des-panneaux">Création des panneaux</h3>
<p>Revenons à <code>RectangleAppFrame</code>. On va stocker deux variables d’instances qui pointent sur les deux panneaux.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> RectangleAppFrame <span class="kw">extends</span> <span class="bu">JFrame</span> <span class="kw">implements</span> RectangleAppView {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a>    </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true"></a>    RectanglePanel rectanglePanel;</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true"></a>    <span class="bu">JPanel</span> buttonPanel;</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true"></a>    </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true"></a>    <span class="kw">public</span> <span class="fu">RectangleAppFrame</span>(<span class="bu">String</span> name, <span class="dt">int</span> boundx, <span class="dt">int</span> boundy) {</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true"></a>        ...</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true"></a>        rectanglePanel = <span class="kw">new</span> <span class="fu">RectanglePanel</span>(boundx, boundy);</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true"></a>        buttonPanel = <span class="kw">new</span> <span class="bu">JPanel</span>();</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true"></a>        buttonPanel.<span class="fu">setPreferredSize</span>(<span class="kw">new</span> <span class="bu">Dimension</span>(<span class="dv">300</span>, boundy));</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true"></a>        <span class="fu">add</span>(rectanglePanel, <span class="bu">BorderLayout</span>.<span class="fu">WEST</span>);</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true"></a>        <span class="fu">add</span>(buttonPanel, <span class="bu">BorderLayout</span>.<span class="fu">EAST</span>);</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true"></a>        <span class="fu">pack</span>();</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true"></a>    }</span></code></pre></div>
<p>On fabrique les panneaux, on donne les bonnes dimensions au panneau des boutons. On ajoute les panneaux à la fenêtre principale (qui contient aussi un panneau). Puis on appelle <code>pack()</code> qui va automatiquement calculer la taille de la fenêtre en fonction de la taille de ses panneaux.</p>
</div>
<div class="slide section level1">

<h3 id="point-info-layout">Point info “layout”</h3>
<p>Le positionnement des composants à l’intérieur d’un panneau est défini par son “layout”. La fenêtre principale possède par défaut un panneau dont le layout est “Border layout” : cela signifie qu’on peut ajouter 5 sous-panneaux (est, ouest, nord, sud et centre). Par défaut, les <code>JPanel</code> utilisent par défaut un layout appelé <code>FlowLayout</code> où les éléments se placent les uns à la suite des autres de façon assez naturelle. Il existe d’autres layout (<code>GridLayout</code>, <code>BoxLayout</code>, etc.).</p>
<p>Je ne vous donne pas des explications détaillées sur le fonctionnement des layout : à vous de chercher et vous renseigner quand vous en aurez besoin.</p>
</div>
<div class="slide section level1">

<h3 id="implémentation-de-linterface-rectangleappview">Implémentation de l’interface <code>RectangleAppView</code></h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> RectangleAppFrame <span class="kw">extends</span> <span class="bu">JFrame</span> <span class="kw">implements</span> RectangleAppView {</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a>    </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a>    ...</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true"></a>    </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">initialize</span>() {</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true"></a>        <span class="fu">setVisible</span>(<span class="kw">true</span>);</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true"></a>    }</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">setRectangle</span>(<span class="bu">Rectangle</span> rectangle) {</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true"></a>        rectanglePanel.<span class="fu">setRectangle</span>(rectangle);</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true"></a>    }</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true"></a>}</span></code></pre></div>
<p>L’initialisation ne fait que rendre la fenêtre visible. La méthode <code>setRectangle</code> délègue au panneau rectangle.</p>
</div>
<div class="slide section level1">

<h3 id="un-contrôleur-pour-lancer-linterface">Un contrôleur pour lancer l’interface</h3>
<p>On crée une classe <code>RectangleController</code></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> RectangleController {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a>    </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">final</span> <span class="dt">int</span> BOUNDX = <span class="dv">500</span>;</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">final</span> <span class="dt">int</span> BOUNDY = <span class="dv">300</span>;</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true"></a>    </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true"></a>    <span class="kw">private</span> <span class="bu">Rectangle</span> rectangle;</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true"></a>    <span class="kw">private</span> RectangleAppView view;</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true"></a>    <span class="kw">public</span> <span class="fu">RectangleController</span>() {</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true"></a>        <span class="bu">Rectangle</span>.<span class="fu">setMaxx</span>(BOUNDX);</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true"></a>        <span class="bu">Rectangle</span>.<span class="fu">setMaxy</span>(BOUNDY);</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true"></a>        view = <span class="kw">new</span> <span class="fu">RectangleAppFrame</span>(<span class="st">&quot;My Rectangle app&quot;</span>, BOUNDX, BOUNDY);</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true"></a>    }</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true"></a>    </span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">initialize</span>() {</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true"></a>        view.<span class="fu">initialize</span>();</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true"></a>    }</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true"></a>}</span></code></pre></div>
<p>La classe contient un pointeur sur le modèle et un sur la vue. Pour l’instant, elle initialise les valeurs statiques du modèle et la vue.</p>
</div>
<div class="slide section level1">

<h3 id="la-fonction-main">La fonction main</h3>
<p>La fonction <code>main</code> va servir à lancer l’application, ce qui se fait ici en lançant la méthode <code>initialize</code> du contrôleur. On va le faire de cette façon :</p>
<pre><code>SwingUtilities.invokeLater(() -&gt; new RectangleController().initialize());</code></pre>
<p><em>Mais c’est quoi cette façon bizare ?</em> C’est à cause des <em>threads</em>. Pour simplifier, les threads sont les différents sous-programmes de votre programme. Et pour que ça marche bien, le graphique doit être géré dans un thread à part. L’appel à <code>SwingUtilities</code> permet un appel différé par le thread en question. A votre niveau, vous n’avez pas besoin de comprendre le détail. Pour des applications graphiques simples, le <em>multi threading</em> se passe sans que ayez à vous en soucier en dehors de cette ligne d’appel.</p>
</div>
<div class="slide section level1">

<h3 id="quest-ce-que-fait-le-programme">Qu’est-ce que fait le programme ?</h3>
<p>On a maintenant les éléments minimums de la vue et du contrôleur pour lancer notre programme. Pour l’instant, il ne fait qu’ouvrir une fenêtre avec un grand panneau blanc et un plus petit panneau gris. Il n’y a aucun rectangle, c’est pas <em>ultra</em> intéressant…</p>
<p><img src="media/graphique_1.png" alt="Image de la fenêtre obtenue : une fenêtre avec un rectangle blanc et un gris" /><br />
</p>
<p>Mais on y arrive !</p>
</div>
<div class="slide section level1">

<h2 id="créer-et-dessiner-un-rectangle">Créer et dessiner un rectangle</h2>
<p>Le but est de contrôler un rectangle : pour ça il faut qu’on crée et qu’on dessine ce rectangle.</p>
</div>
<div class="slide section level1">

<h3 id="côté-contrôleur">Côté contrôleur</h3>
<p>A l’initialisation du contrôleur, on va créer un nouveau rectangle et le passer à la vue.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">initialize</span>() {</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true"></a>        <span class="bu">Rectangle</span>.<span class="fu">setMaxx</span>(BOUNDX);</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true"></a>        <span class="bu">Rectangle</span>.<span class="fu">setMaxy</span>(BOUNDY);</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true"></a>        rectangle = <span class="kw">new</span> <span class="bu">Rectangle</span>(<span class="dv">250</span>, <span class="dv">150</span>, <span class="dv">30</span>, <span class="dv">20</span>);</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true"></a>        rectangle.<span class="fu">setFillColor</span>(<span class="bu">Color</span>.<span class="fu">BLUE</span>);</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true"></a>        view.<span class="fu">setRectangle</span>(rectangle);</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true"></a>        view.<span class="fu">initialize</span>();</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true"></a>    }</span></code></pre></div>
</div>
<div class="slide section level1">

<h3 id="côté-vue">Côté Vue</h3>
<p>Dans la classe <code>RectanglePanel</code>, on va faire en sorte de dessiner le rectangle. Pour cela on surcharge (<em>override</em>) la méthode <code>paintComponent</code> héritée de <code>JPanel</code>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> RectanglePanel <span class="kw">extends</span> <span class="bu">JPanel</span> {</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true"></a>    ...</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true"></a>    </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">paintComponent</span>(<span class="bu">Graphics</span> g) {</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true"></a>        <span class="kw">super</span>.<span class="fu">paintComponent</span>(g);</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true"></a>        <span class="kw">if</span>(rectangle != <span class="kw">null</span>) {</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true"></a>            g.<span class="fu">setColor</span>(rectangle.<span class="fu">getFillColor</span>());</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true"></a>            g.<span class="fu">fillRect</span>(rectangle.<span class="fu">getX</span>(), rectangle.<span class="fu">getY</span>(), rectangle.<span class="fu">getWidth</span>(), rectangle.<span class="fu">getHeight</span>());</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true"></a>        }</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true"></a>    }</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true"></a>    </span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true"></a>    ...</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<h3 id="lancement-de-lapplication">Lancement de l’application</h3>
<p>Maintenant, on voit un rectangle bleu apparaître sur fond blanc quand on lance l’application. (<em>Ouah… Trop beau..</em>)</p>
<p><img src="media/graphique_2.png" alt="Image de la fenêtre obtenue : une fenêtre avec un rectangle gris vide et un rectangle blanc contenant un rectangle bleu" /><br />
</p>
<p>Ca reste assez peu intéressant, comment contrôler le rectangle ?</p>
</div>
<div class="slide section level1">

<h2 id="fabriquer-un-bouton">Fabriquer un bouton</h2>
<p>On va ajouter un bouton pour faire apparaître le rectangle. Dans Swing, il y a une classe spéciale pour les boutons <code>JButton</code>. On va créé une variable dans la vue et l’ajouter au panneau des boutons.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> RectangleAppFrame <span class="kw">extends</span> <span class="bu">JFrame</span> <span class="kw">implements</span> RectangleAppView {</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true"></a>    ...</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true"></a>    <span class="bu">JButton</span> makeRectangleBtn;</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true"></a>    ...</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true"></a>    </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">initialize</span>() {</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true"></a>        makeRectangleBtn = <span class="kw">new</span> <span class="bu">JButton</span>(<span class="st">&quot;Create rectangle&quot;</span>);</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true"></a>        buttonPanel.<span class="fu">add</span>(makeRectangleBtn);</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true"></a>        rectanglePanel.<span class="fu">initialize</span>();</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true"></a>        <span class="fu">setVisible</span>(<span class="kw">true</span>);</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true"></a>    }</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<p>L’application ressemble maintenant à ça :</p>
<p><img src="media/graphique_3.png" alt="Image de la fenêtre obtenue : une fenêtre avec un rectangle gris vide contenant un bouton “Create Rectangle” et un rectangle blanc contenant un rectangle bleu" /><br />
</p>
<p>Mais comment faire pour qu’il se passe quelque chose quand on appuie sur le bouton ?</p>
</div>
<div class="slide section level1">

<h2 id="côté-contrôleur-1">Côté contrôleur</h2>
<p>On va créer le moyen de recevoir des actions depuis la vue. Pour cela, on crée un <code>enum</code> avec la liste des actions possibles (pour l’instant une seule action).</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">enum</span> RectangleAction {</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true"></a>    CREATE</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<p>Et dans la classe <code>RectangleController</code> lui-même, on implémente de quoi recevoir l’action</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">createRectangle</span>() {</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true"></a>        rectangle = <span class="kw">new</span> <span class="bu">Rectangle</span>(<span class="dv">250</span>, <span class="dv">150</span>, <span class="dv">30</span>, <span class="dv">20</span>);</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true"></a>        rectangle.<span class="fu">setFillColor</span>(<span class="bu">Color</span>.<span class="fu">BLUE</span>);</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true"></a>        view.<span class="fu">setRectangle</span>(rectangle);</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true"></a>    }</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">receiveAction</span>(RectangleAction action) {</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true"></a>        <span class="kw">switch</span> (action) {</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true"></a>            <span class="kw">case</span> CREATE: <span class="fu">createRectangle</span>(); <span class="kw">break</span>;</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true"></a>        }</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true"></a>    }</span></code></pre></div>
</div>
<div class="slide section level1">

<p>Enfin, on rajoute un lien vers le contrôleur depuis la vue, pour que la vue puisse envoyer des actions</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">interface</span> RectangleAppView {</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true"></a>    ...</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true"></a>    <span class="dt">void</span> <span class="fu">setController</span>(RectangleController controller);</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<p>Le contrôleur est stocké dans un champs privé de la vue. Au moment d’initialiser la vue dans <code>RectangleController</code>, on lui envoie le contrôleur</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">initialize</span>() {</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true"></a>    view.<span class="fu">setController</span>(<span class="kw">this</span>);</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true"></a>    view.<span class="fu">initialize</span>();</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true"></a>}</span></code></pre></div>
<p><strong>Remarque :</strong> la seule interaction que la vue doit avoir avec le contrôleur, c’est d’envoyer une action. Pour plus de modularité, on pourrait donc stocker uniquement “la partie” du contrôleur qui reçoit les actions (par un objet ou une interface dédiée)</p>
</div>
<div class="slide section level1">

<h2 id="mais-comment-faire-pour-le-lier-au-bouton">Mais comment faire pour le lier au bouton ?</h2>
<p>On a besoin que quand on clique sur le bouton, ça envoie la bonne action au contrôleur</p>
</div>
<div class="slide section level1">

<h2 id="les-évènements-et-les-listeners">Les évènements et les <code>Listeners</code></h2>
<p>Suivant le principe du MVC, <code>Swing</code> sépare l’objet graphique bouton de l’action enclenchée par le clic. Tout le principe de l’interface graphique est basée sur l’idée “d’évènements” qui sont lancés par les composants et “écoutés” par d’autres classes. C’est un framework qui est directement inspiré par la philosophie du MVC et que l’on retrouve, sous une forme ou une autre, dans la plupart des bibliothèques graphiques.</p>
<p>Ici, on a rajouté une couche supplémentaire avec notre contrôleur pour pouvoir recevoir des actions de façon indépendante de l’architecture de <code>Swing</code>.</p>
</div>
<div class="slide section level1">

<h3 id="nos-listener-de-boutons">Nos listener de boutons</h3>
<p>Dans notre application, on va créer une classe <code>ButtonListener</code> (dans la partie vue) qui servira à écouter nos différents boutons</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> ButtonListener <span class="kw">implements</span> <span class="bu">ActionListener</span> {</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true"></a>    <span class="kw">private</span> <span class="dt">final</span> RectangleController controller;</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true"></a>    <span class="kw">private</span> <span class="dt">final</span> RectangleAction action;</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true"></a>    <span class="kw">public</span> <span class="fu">ButtonListener</span>(RectangleController controller, RectangleAction action) {</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true"></a>        <span class="kw">this</span>.<span class="fu">controller</span> = controller;</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true"></a>        <span class="kw">this</span>.<span class="fu">action</span> = action;</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true"></a>    }</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">actionPerformed</span>(<span class="bu">ActionEvent</span> actionEvent) {</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true"></a>        controller.<span class="fu">receiveAction</span>(action);</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true"></a>    }</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<p>Au moment de la création du bouton, on le relie à un écouteur de boutons avec la bonne action</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true"></a>makeRectangleBtn.<span class="fu">addActionListener</span>(<span class="kw">new</span> <span class="fu">ButtonListener</span>(controller, RectangleAction.<span class="fu">CREATE</span>));</span></code></pre></div>
</div>
<div class="slide section level1">

<h3 id="faire-apparaître-le-rectangle-quand-on-clique">Faire apparaître le rectangle quand on clique</h3>
<p>Donc maintenant, le contrôleur ne crée le rectangle que lorsqu’il en reçoit l’ordre et le bouton est configuré pour envoyer l’ordre au moment du click par le biais de son “écouteur”.</p>
<p>Donc tout est parfait !</p>
</div>
<div class="slide section level1">

<h3 id="ca-ne-marche-pas">Ca ne marche pas !!!</h3>
<p><strong>POURQUOI ?</strong> <em>Désespoir</em></p>
</div>
<div class="slide section level1">

<p>Mais non, il y a une raison simple : la vue ne sait pas que quelque chose a changé, elle a besoin d’être mise à jour.</p>
<p>On rajoute une méthode <code>update</code> dans l’interface et dans la classe :</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">update</span>() {</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true"></a>        rectanglePanel.<span class="fu">repaint</span>();</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true"></a>    }</span></code></pre></div>
<p>La méthode <code>update</code> appelle la méthode <code>repaint</code> du <code>JPanel</code> <code>rectanglePanel</code>.</p>
</div>
<div class="slide section level1">

<p>Et bien sûr, on appelle <code>update</code> depuis le contrôleur.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">receiveAction</span>(RectangleAction action) {</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true"></a>        <span class="kw">switch</span> (action) {</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true"></a>            <span class="kw">case</span> CREATE: <span class="fu">createRectangle</span>(); <span class="kw">break</span>;</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true"></a>        }</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true"></a>        view.<span class="fu">update</span>();</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true"></a>    }</span></code></pre></div>
<p>Maintenant, ça marche !</p>
</div>
<div class="slide section level1">

<p><strong>Remarque : </strong> vous aurez peut-être remarqué qu’il y a ici deux couches de “contrôle” : les <code>ActionListener</code> de <code>Swing</code> et l’écoute de nos actions spécifiques dans notre contrôleur à nous.</p>
<p>En effet, les <code>ActionListener</code> sont <em>déjà</em> des mini contrôleurs. On pourrait décider de directement implémenter les interfaces de Swing avec notre contrôleur. Cependant, cela rendrait notre architecture très dépendantes des interfaces définies par <code>Swing</code>.</p>
<p>La solution qu’on propose ici permet plus de modularité :</p>
<ul>
<li>la vue gère les différents composants graphiques et envoient les actions nécessaires</li>
<li>le contrôleur agit sur le modèle et la vue en fonction des actions requises.</li>
</ul>
</div>
<div class="slide section level1">

<h2 id="on-fait-un-peu-plus">On fait un peu plus ?</h2>
<p>On va créer un bouton pour faire disparaître le rectangle.</p>
<p>Pour cela une crée une nouvelle action dans le contrôleur</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">enum</span> RectangleAction {</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true"></a>    CREATE,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true"></a>    DELETE</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<div class="sourceCode" id="cb25"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">deleteRectangle</span>() {</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true"></a>        rectangle = <span class="kw">null</span>;</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true"></a>        view.<span class="fu">setRectangle</span>(<span class="kw">null</span>);</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true"></a>    }</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">receiveAction</span>(RectangleAction action) {</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true"></a>        <span class="kw">switch</span> (action) {</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true"></a>            <span class="kw">case</span> CREATE: <span class="fu">createRectangle</span>(); <span class="kw">break</span>;</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true"></a>            <span class="kw">case</span> DELETE: <span class="fu">deleteRectangle</span>(); <span class="kw">break</span>;</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true"></a>        }</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true"></a>        view.<span class="fu">update</span>();</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true"></a>    }</span></code></pre></div>
</div>
<div class="slide section level1">

<p>et un nouveau bouton dans la vue</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> RectangleAppFrame <span class="kw">extends</span> <span class="bu">JFrame</span> <span class="kw">implements</span> RectangleAppView {</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true"></a>    </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true"></a>    ...</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true"></a>    <span class="bu">JButton</span> makeRectangleBtn;</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true"></a>    <span class="bu">JButton</span> deleteRectangleBtn;</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true"></a>    ...</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">initialize</span>() {</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true"></a>        makeRectangleBtn = <span class="kw">new</span> <span class="bu">JButton</span>(<span class="st">&quot;Create rectangle&quot;</span>);</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true"></a>        makeRectangleBtn.<span class="fu">addActionListener</span>(<span class="kw">new</span> <span class="fu">ButtonListener</span>(controller, RectangleAction.<span class="fu">CREATE</span>));</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true"></a>        deleteRectangleBtn = <span class="kw">new</span> <span class="bu">JButton</span>(<span class="st">&quot;Delete Rectangle&quot;</span>);</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true"></a>        deleteRectangleBtn.<span class="fu">addActionListener</span>(<span class="kw">new</span> <span class="fu">ButtonListener</span>(controller, RectangleAction.<span class="fu">DELETE</span>));</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true"></a>        buttonPanel.<span class="fu">add</span>(makeRectangleBtn);</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true"></a>        buttonPanel.<span class="fu">add</span>(deleteRectangleBtn);</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true"></a>        ...</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true"></a>    }</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true"></a>    ...</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true"></a></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<p>C’est super ! Ca marche !</p>
</div>
<div class="slide section level1">

<h2 id="faire-napparaître-que-le-bouton-pertinent">Faire n’apparaître que le bouton pertinent</h2>
<p>Encore une fois, on va essayer de faire ça de façon générique en séparant ce qui relève du contrôleur de ce qui relève de la vue.</p>
<p>On va créer une liste d’états possibles pour la vue avec un enum</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">enum</span> ViewState {</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true"></a>    WITH_RECTANGLE,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true"></a>    WITHOUT_RECTANGLE;</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<p>Et dans l’intervace <code>RectangleAppView</code>, on ajoute une méthode pour modifier l’état de la vue.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">interface</span> RectangleAppView {</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true"></a>    </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true"></a>    ...</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true"></a>    </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true"></a>    <span class="dt">void</span> <span class="fu">setViewState</span>(ViewState state);</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true"></a>    </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true"></a>    ...</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<p>On implémente cette méthode dans la vue en faisant apparaître / disparaître les éléments que l’on souhaite</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">withRectangle</span>() {</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true"></a>        makeRectangleBtn.<span class="fu">setVisible</span>(<span class="kw">false</span>);</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true"></a>        deleteRectangleBtn.<span class="fu">setVisible</span>(<span class="kw">true</span>);</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true"></a>    }</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">withoutRectangle</span>() {</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true"></a>        makeRectangleBtn.<span class="fu">setVisible</span>(<span class="kw">true</span>);</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true"></a>        deleteRectangleBtn.<span class="fu">setVisible</span>(<span class="kw">false</span>);</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true"></a>    }</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">setViewState</span>(ViewState state) {</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true"></a>        <span class="kw">switch</span> (state) {</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true"></a>            <span class="kw">case</span> WITH_RECTANGLE: <span class="fu">withRectangle</span>();</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true"></a>                <span class="kw">break</span>;</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true"></a>            <span class="kw">case</span> WITHOUT_RECTANGLE: <span class="fu">withoutRectangle</span>();</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true"></a>                <span class="kw">break</span>;</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true"></a>        }</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true"></a>    }</span></code></pre></div>
</div>
<div class="slide section level1">

<p>Le contrôleur s’occupe ensuite demander à la vue l’état souhaité.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> RectangleController {</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true"></a>    ....</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">initialize</span>() {</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true"></a>        ...</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true"></a>        view.<span class="fu">setViewState</span>(ViewState.<span class="fu">WITHOUT_RECTANGLE</span>);</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true"></a>    }</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">createRectangle</span>() {</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true"></a>        ...</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true"></a>        view.<span class="fu">setViewState</span>(ViewState.<span class="fu">WITH_RECTANGLE</span>);</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true"></a>    }</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true"></a></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">deleteRectangle</span>() {</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true"></a>        ...</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true"></a>        view.<span class="fu">setViewState</span>(ViewState.<span class="fu">WITHOUT_RECTANGLE</span>);</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true"></a>    }</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<h2 id="on-rajoute-plein-de-boutons">On rajoute plein de boutons :</h2>
<p>De la même façon, on peut rajouter des boutons correspondants à toutes les actions suivantes :</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">enum</span> RectangleAction {</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true"></a>    CREATE,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true"></a>    DELETE,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true"></a>    MOVE_LEFT,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true"></a>    MOVE_RIGHT,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true"></a>    MOVE_UP,</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true"></a>    MOVE_DOWN,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true"></a>    INCREASE_WIDTH,</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true"></a>    DECREASE_WIDTH,</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true"></a>    INCREASE_HEIGHT,</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true"></a>    DECREASE_HEIGHT</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<h2 id="contrôle-au-clavier">Contrôle au clavier</h2>
<p>On va créer une implémentation de la classe <code>KeyListener</code> de <code>Swing</code> pour envoyer ces mêmes actions avec les touches du clavier.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true"></a></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> RectangleKeyListener <span class="kw">implements</span> <span class="bu">KeyListener</span> {</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true"></a>    <span class="kw">private</span> <span class="dt">final</span> RectangleController controller;</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true"></a>    <span class="kw">public</span> <span class="fu">RectangleKeyListener</span>(RectangleController controller) {</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true"></a>        <span class="kw">this</span>.<span class="fu">controller</span> = controller;</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true"></a>    }</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true"></a>    </span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true"></a>    <span class="kw">...    </span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<p>Il y a 3 méthodes à implanter pour cette interface :</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">keyTyped</span>(<span class="bu">KeyEvent</span> keyEvent);</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">keyPressed</span>(<span class="bu">KeyEvent</span> keyEvent)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">keyReleased</span>(<span class="bu">KeyEvent</span> keyEvent) </span></code></pre></div>
<p>L’objet <code>KeyEvent</code> de swing permet de récupérer la touche du clavier qui a été pressée.</p>
</div>
<div class="slide section level1">

<p>On laisse <code>keyTyped</code> et <code>keyReleasead</code> vides et on implémente <code>keyPressed</code></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">keyPressed</span>(<span class="bu">KeyEvent</span> keyEvent) {</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true"></a>        <span class="kw">switch</span>(keyEvent.<span class="fu">getKeyCode</span>()) {</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true"></a>            <span class="kw">case</span> <span class="bu">KeyEvent</span>.<span class="fu">VK_LEFT</span>:</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true"></a>                controller.<span class="fu">receiveAction</span>(RectangleAction.<span class="fu">MOVE_LEFT</span>);</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true"></a>                <span class="kw">break</span>;</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true"></a>            <span class="kw">case</span> <span class="bu">KeyEvent</span>.<span class="fu">VK_RIGHT</span>:</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true"></a>                controller.<span class="fu">receiveAction</span>(RectangleAction.<span class="fu">MOVE_RIGHT</span>);</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true"></a>                <span class="kw">break</span>;</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true"></a>            <span class="kw">case</span> <span class="bu">KeyEvent</span>.<span class="fu">VK_UP</span>:</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true"></a>                controller.<span class="fu">receiveAction</span>(RectangleAction.<span class="fu">MOVE_UP</span>);</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true"></a>                <span class="kw">break</span>;</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true"></a>            <span class="kw">case</span> <span class="bu">KeyEvent</span>.<span class="fu">VK_DOWN</span>:</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true"></a>                controller.<span class="fu">receiveAction</span>(RectangleAction.<span class="fu">MOVE_DOWN</span>);</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true"></a>                <span class="kw">break</span>;</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true"></a>            <span class="kw">case</span> <span class="bu">KeyEvent</span>.<span class="fu">VK_C</span>:</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true"></a>                controller.<span class="fu">receiveAction</span>(RectangleAction.<span class="fu">DECREASE_WIDTH</span>);</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true"></a>                <span class="kw">break</span>;</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true"></a>            <span class="kw">case</span> <span class="bu">KeyEvent</span>.<span class="fu">VK_V</span>:</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true"></a>                controller.<span class="fu">receiveAction</span>(RectangleAction.<span class="fu">INCREASE_WIDTH</span>);</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true"></a>                <span class="kw">break</span>;</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true"></a>            <span class="kw">case</span> <span class="bu">KeyEvent</span>.<span class="fu">VK_B</span>:</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true"></a>                controller.<span class="fu">receiveAction</span>(RectangleAction.<span class="fu">DECREASE_HEIGHT</span>);</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true"></a>                <span class="kw">break</span>;</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true"></a>            <span class="kw">case</span> <span class="bu">KeyEvent</span>.<span class="fu">VK_N</span>:</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true"></a>                controller.<span class="fu">receiveAction</span>(RectangleAction.<span class="fu">INCREASE_HEIGHT</span>);</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true"></a>                <span class="kw">break</span>;</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true"></a>        }</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true"></a>    }</span></code></pre></div>
</div>
<div class="slide section level1">

<p>Ensuite, dans <code>RectangleAppFrame</code>, on s’assure de</p>
<ul>
<li>créer “l’écouteur de clavier” (on le crée une seule fois, on le garde dans un champ de l’instance, comme les boutons)</li>
<li>de l’ajouter comme écouteurs à la fenêtre principale (on “écoute” en général le clavier avec la fenêtre principale)</li>
</ul>
</div>
<div class="slide section level1">

<div class="sourceCode" id="cb35"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> RectangleAppFrame <span class="kw">extends</span> <span class="bu">JFrame</span> <span class="kw">implements</span> RectangleAppView {</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true"></a>    </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true"></a>    ...</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true"></a>    RectangleKeyListener keyListener;</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true"></a>    </span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">initialize</span>() {</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true"></a>        ...</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true"></a>        keyListener = <span class="kw">new</span> <span class="fu">RectangleKeyListener</span>(controller);</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true"></a>        ...</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true"></a>    }</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true"></a></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true"></a></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">withRectangle</span>() {</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true"></a>        ...</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true"></a>        <span class="fu">addKeyListener</span>(keyListener);</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true"></a>    }</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true"></a></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">withoutRectangle</span>() {</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true"></a>        ...</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true"></a>        <span class="fu">removeKeyListener</span>(keyListener);</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true"></a>    }</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true"></a>    </span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true"></a>    ...</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<p>Il faut aussi, pour des raisons techniques, spécifier explicitement que la fenêtre est “focusable”</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true"></a>    <span class="kw">public</span> <span class="fu">RectangleAppFrame</span>(<span class="bu">String</span> name, <span class="dt">int</span> boundx, <span class="dt">int</span> boundy) {</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true"></a>        <span class="kw">super</span>();</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true"></a>        <span class="fu">setTitle</span>(name);</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true"></a>        <span class="fu">setDefaultCloseOperation</span>(<span class="bu">JFrame</span>.<span class="fu">EXIT_ON_CLOSE</span>);</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true"></a>        <span class="kw">this</span>.<span class="fu">setFocusable</span>(<span class="kw">true</span>);</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true"></a>        ...</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true"></a>    }</span></code></pre></div>
</div>
<div class="slide section level1">

<p>On récupère le focus à chaque fois qu’on active l’écoute clavier</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">withRectangle</span>() {</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true"></a>        ...</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true"></a>        <span class="fu">addKeyListener</span>(keyListener);</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true"></a>        <span class="fu">requestFocus</span>();</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true"></a>    }</span></code></pre></div>
<p>Ainsi qu’à chaque mise à jour de la vue (car sinon le focus reste sur les boutons)</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">update</span>() {</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true"></a>    rectanglePanel.<span class="fu">repaint</span>();</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true"></a>    <span class="fu">requestFocus</span>();</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<h2 id="contrôle-de-la-souris">Contrôle de la souris</h2>
<p>On veut pouvoir déplacer le rectangle à la souris. Pour cela, on peut implanter l’interface <code>MouseMotionListener</code> de <code>Swing</code></p>
<p>(Note : pour traiter les simples clics de la souris, on utilisera à la place <code>MouseListener</code>)</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> RectangleMouseListener <span class="kw">implements</span> <span class="bu">MouseMotionListener</span> {</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true"></a>    ...</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">mouseDragged</span>(<span class="bu">MouseEvent</span> mouseEvent) {</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true"></a>        ...</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true"></a>    }</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">mouseMoved</span>(<span class="bu">MouseEvent</span> mouseEvent) {</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true"></a>        ...</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true"></a>    }</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<p>L’idée : lors d’un évènement <code>mouseDragged</code> on vérifiera si on est à l’intérieur ou hors du rectangle. Si on est dans le rectangle, on calcule le changement de position par rapport à l’évènement précédent et on envoie une action au contrôleur. En analysant le problème, on réalise que :</p>
<ul>
<li>notre listener doit avoir accès au rectangle (pour savoir si le clic se situe à l’intérieur du rectangle)</li>
<li>on a besoin d’une action supplémentaire au niveau controleur et d’envoyer des informations de mouvement</li>
</ul>
</div>
<div class="slide section level1">

<p>Dans le contrôleur, on crée donc :</p>
<p>(l’action <code>MOVE</code> a été ajoutée à la liste des <code>RectangleAction</code>)</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> RectangleController {</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true"></a>    ...</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true"></a>    </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">receiveAction</span>(RectangleAction action, <span class="dt">int</span> diffx, <span class="dt">int</span> diffy) {</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true"></a>        <span class="kw">switch</span> (action) {</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true"></a>            <span class="kw">case</span> MOVE:</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true"></a>                rectangle.<span class="fu">trymove</span>(diffx, diffy);</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true"></a>                <span class="kw">break</span>;</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true"></a>        }</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true"></a>        view.<span class="fu">update</span>();</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true"></a>    }</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true"></a>    </span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true"></a>    ...</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<p>Côté “écouteur”, construction :</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> RectangleMouseListener <span class="kw">implements</span> <span class="bu">MouseMotionListener</span> {</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true"></a>    </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true"></a>    </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true"></a>    <span class="kw">private</span> <span class="dt">final</span> RectangleController controller;</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true"></a>    <span class="kw">private</span> <span class="bu">Rectangle</span> rectangle;</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true"></a>    </span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true"></a>    <span class="kw">private</span> <span class="dt">boolean</span> startDrag;</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true"></a>    <span class="dt">int</span> prevx;</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true"></a>    <span class="dt">int</span> prevy;</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true"></a>    <span class="kw">public</span> <span class="fu">RectangleMouseListener</span>(RectangleController controller) {</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true"></a>        <span class="kw">this</span>.<span class="fu">controller</span> = controller;</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true"></a>        startDrag = <span class="kw">false</span>;</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true"></a>    }</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true"></a></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">setRectangle</span>(<span class="bu">Rectangle</span> rectangle) {</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true"></a>        <span class="kw">this</span>.<span class="fu">rectangle</span> = rectangle;</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true"></a>    }</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true"></a>    </span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true"></a>    ...</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<p>Implémentation :</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> RectangleMouseListener <span class="kw">implements</span> <span class="bu">MouseMotionListener</span> {</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true"></a>    ...</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true"></a>    </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">mouseDragged</span>(<span class="bu">MouseEvent</span> mouseEvent) {</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true"></a>        <span class="kw">if</span>(! startDrag) {</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true"></a>            <span class="dt">int</span> x = mouseEvent.<span class="fu">getX</span>();</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true"></a>            <span class="dt">int</span> y = mouseEvent.<span class="fu">getY</span>();</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true"></a>            <span class="kw">if</span>(rectangle.<span class="fu">insideRectanle</span>(x, y)) {</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true"></a>                startDrag = <span class="kw">true</span>;</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true"></a>                prevx = x;</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true"></a>                prevy = y;</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true"></a>            }</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true"></a>        } <span class="kw">else</span> {</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true"></a>            <span class="dt">int</span> diffx = mouseEvent.<span class="fu">getX</span>() - prevx;</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true"></a>            <span class="dt">int</span> diffy = mouseEvent.<span class="fu">getY</span>() - prevy;</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true"></a>            controller.<span class="fu">receiveAction</span>(RectangleAction.<span class="fu">MOVE</span>, diffx, diffy);</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true"></a>            prevx = mouseEvent.<span class="fu">getX</span>();</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true"></a>            prevy = mouseEvent.<span class="fu">getY</span>();</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true"></a>        }</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true"></a>    }</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true"></a></span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">mouseMoved</span>(<span class="bu">MouseEvent</span> mouseEvent) {</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true"></a>        startDrag = <span class="kw">false</span>;</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true"></a>    }</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<p>Pour que ça fonctionne, il faut que l’écouteur soit créé dans la vue et qu’on lui envoie le rectangle</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> RectangleAppFrame <span class="kw">extends</span> <span class="bu">JFrame</span> <span class="kw">implements</span> RectangleAppView {</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true"></a>    </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true"></a>    ...</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true"></a>    </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true"></a>    RectangleMouseListener mouseListener;</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true"></a>    </span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true"></a>    ...</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">initialize</span>() {</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true"></a>        ...</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true"></a>        mouseListener = <span class="kw">new</span> <span class="fu">RectangleMouseListener</span>(controller);</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true"></a>        ...</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true"></a>    }</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true"></a></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">setRectangle</span>(<span class="bu">Rectangle</span> rectangle) {</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true"></a>        rectanglePanel.<span class="fu">setRectangle</span>(rectangle);</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true"></a>        mouseListener.<span class="fu">setRectangle</span>(rectangle);</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true"></a>    }</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true"></a></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<p>Et qu’on ajoute l’écouteur au bon composant au moment adéquat : ici, c’est le rectanglePanel qui doit “écouter” la souris.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> RectangleAppFrame <span class="kw">extends</span> <span class="bu">JFrame</span> <span class="kw">implements</span> RectangleAppView {</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true"></a>    </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true"></a>    ...</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">withRectangle</span>() {</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true"></a>        ...</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true"></a>        rectanglePanel.<span class="fu">addMouseMotionListener</span>(mouseListener);</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true"></a>    }</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true"></a></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">withoutRectangle</span>() {</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true"></a>        ...</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true"></a>        rectanglePanel.<span class="fu">removeMouseMotionListener</span>(mouseListener);</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true"></a>    }</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true"></a></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<h2 id="point-info-classe-interne">Point info : classe interne</h2>
<p>Les classes “écouteuses” ne sont utilisées que par <code>RectangleAppFrame</code> et ont souvent besoin d’accéder à des champs de l’instance (comme le contrôleur qu’on a à chaque fois passé comme un champ privé). On pourrait en fait en faire des <strong>classes internes</strong> qui sont régulièrement utilisées dans les interfaces graphiques en particulier.</p>
<p>A votre niveau, vous n’êtes jamais obligé de l’utiliser mais vous pourriez tomber dessus dans des architectures un peu plus compliquées.</p>
</div>
<div class="slide section level1">

<h2 id="conclusion-le-rôle-du-contrôleur">Conclusion : Le rôle du contrôleur</h2>
<p>Dans notre architecture :</p>
<ul>
<li>le contrôleur s’occupe de modifier le modèle</li>
<li>le contrôleur s’occupe de lancer les différentes phases</li>
<li>le contrôleur s’occupe de réagir aux actions de l’utilisateur remontées par la vue</li>
<li>le contrôleur ne s’occupe <strong>pas</strong> de quels sont les composants qui remontent les informations ni de ce qui est concrètement affiché par la vue</li>
</ul>
</div>
<div class="slide section level1">

<h2 id="conclusion-le-rôle-de-la-vue">Conclusion : le rôle de la vue</h2>
<p>Dans notre architecture :</p>
<ul>
<li>la vue s’occupe des détails techniques de l’interface graphique (composants, structure, etc)</li>
<li>la vue s’occupe d’afficher le modèle à l’utilisateur-trice</li>
<li>la vue s’occupe de ce qui s’affiche / ne s’affiche pas dans les différentes phases de l’appli</li>
<li>la vue s’occupe de la gestion des “écouteurs” pour faire remonter les actions au contrôleur</li>
<li>l’interface de la vue utilisée par le contrôleur est complètement indépendante de l’architecture graphique utilisée</li>
<li>la vue ne modifie PAS le modèle</li>
<li>la vue ne prend aucune décision quant au fonctionnement de l’appli ou aux conséquences des actions demandées</li>
</ul>
</div>
<div class="slide section level1">

<h2 id="les-limites">les limites</h2>
<p>Ceci n’est qu’une possibilité d’architecture, ce ne sera pas forcément la réponse à chaque fois.</p>
<p>Par exemple, dans notre architecture, la vue possède un pointeur sur le modèle et sur le contrôleur : il n’y a pas de garantie dans l’architecture même qu’elle ne va pas “outrepasser” ses droits.</p>
<p>On peut aussi décider que le contrôleur écoute directement les composants pour agir sur le modèle (dans ce cas, le contrôleur dépend de l’architecture de l’interface graphique) et que la vue n’a pas accès au contrôleur.</p>
<p>Ce qu’il faut garder à l’esprit : c’est une philosophie générale qu’il faut essayer d’adapter à bon escient. Le principe est de séparer les rôles.</p>
</div>
</body>
</html>
