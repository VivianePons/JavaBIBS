<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Viviane Pons" />
  <title>Programmation Orientée Objet – Java</title>
  <style type="text/css">
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" type="text/css" media="screen, projection, print"
    href="https://www.w3.org/Talks/Tools/Slidy2/styles/slidy.css" />
  <link rel="stylesheet" type="text/css" media="screen, projection, print"
   href="slidy/custom.css" />
  <script src="https://www.w3.org/Talks/Tools/Slidy2/scripts/slidy.js"
    charset="utf-8" type="text/javascript"></script>
</head>
<body>
<div class="slide titlepage">
  <h1 class="title">Programmation Orientée Objet – Java</h1>
  <p class="subtitle">Cours 5 : Applications graphiques et design MVC</p>
  <p class="author">
Viviane Pons
  </p>
  <p class="date">Master BIBS Université Paris-Saclay</p>
</div>
<div id="comment-créer-une-interface-graphique" class="slide section level1">
<h1>Comment créer une interface graphique ?</h1>
<p>Une interface graphique est un système de communication avec l’utilisateur final utilisant un affichage dans une fenêtre et réagissant aux actions de l’utilisateur tels que les clics et le clavier.</p>
<p>Côté programmation, cela demande d’interagir avec le système d’exploitation qui gère les différentes applications et les actions de l’utilisateur.</p>
<p>Java offre plusieurs bibliothèques :</p>
<ul>
<li><p>la bibliothèque historique <code>AWT</code> pour “Abstract Window Toolkit” : interfaçage bas niveau avec le système d’exploitation</p></li>
<li><p>la bibliothèque <code>Swing</code> : plus indépendante du système d’exploitation mais qui réutilise de nombreux composants <code>awt</code> – encore très classique même si un peu ancienne</p></li>
<li><p>la bibliothèque <code>JavaFX</code> : plus récente , architecture plus moderne et plus adaptée aux nouveaux supports (écrans tactiles par exemple). Nouvelle bibliothèque par défaut</p></li>
</ul>
<p>Cette année, on travaille avec le classique <code>Swing</code> car : encore très utilisé et distribué plus largement.</p>
</div>
<div class="slide section level1">

<h2 id="premier-exemple">Premier exemple</h2>
<p>“Hello World” <code>Swing</code></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="bu">JFrame</span> fenetre = <span class="kw">new</span> <span class="bu">JFrame</span>();</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>fenetre.<span class="fu">setTitle</span>(<span class="st">&quot;Première fenêtre en java&quot;</span>);</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a>fenetre.<span class="fu">setBounds</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">300</span>,<span class="dv">100</span>); </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>fenetre.<span class="fu">setDefaultCloseOperation</span>(<span class="bu">JFrame</span>.<span class="fu">EXIT_ON_CLOSE</span>);</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a><span class="bu">JPanel</span> panel = <span class="kw">new</span> <span class="bu">JPanel</span>();</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a><span class="bu">JLabel</span> helloWorld = <span class="kw">new</span> <span class="bu">JLabel</span>(<span class="st">&quot;Hello World !&quot;</span>);</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a>panel.<span class="fu">add</span>(helloWorld);</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a>fenetre.<span class="fu">getContentPane</span>().<span class="fu">add</span>(panel);</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a>fenetre.<span class="fu">setVisible</span>(<span class="kw">true</span>);</span></code></pre></div>
</div>
<div class="slide section level1">

<p>Ajout d’un bouton</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="bu">JFrame</span> fenetre = <span class="kw">new</span> <span class="bu">JFrame</span>();</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>fenetre.<span class="fu">setTitle</span>(<span class="st">&quot;Première fenêtre en java&quot;</span>);</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>fenetre.<span class="fu">setBounds</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">300</span>,<span class="dv">100</span>); </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>fenetre.<span class="fu">setDefaultCloseOperation</span>(<span class="bu">JFrame</span>.<span class="fu">EXIT_ON_CLOSE</span>);</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a><span class="bu">JPanel</span> panel = <span class="kw">new</span> <span class="bu">JPanel</span>();</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a><span class="bu">JLabel</span> helloWorld = <span class="kw">new</span> <span class="bu">JLabel</span>(<span class="st">&quot;Hello World !&quot;</span>);</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a><span class="bu">JButton</span> bouton = <span class="kw">new</span> <span class="bu">JButton</span>(<span class="st">&quot;Je suis un bouton&quot;</span>);</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a>panel.<span class="fu">add</span>(helloWorld);</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a>panel.<span class="fu">add</span>(bouton);</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a>fenetre.<span class="fu">getContentPane</span>().<span class="fu">add</span>(panel);</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a>fenetre.<span class="fu">setVisible</span>(<span class="kw">true</span>);</span></code></pre></div>
<p>Et ensuite ? Comment faire pour gérer le clic sur le bouton ? Plus généralement, comment lier l’interface graphique au reste du programme ?</p>
</div>
<div id="un-peu-de-design-pattern-larchitecture-modèle-vue-contrôleur" class="slide section level1">
<h1>Un peu de <em>design pattern</em> : l’architecture <em>Modèle-Vue-Contrôleur</em></h1>
<p>Qu’est-ce que les <em>design patterns</em> ? Ou <em>patrons de conception</em> en français : ce sont des <strong>solutions à des problèmes</strong></p>
<ul>
<li>Solutions considérées comme des “bonnes pratiques”</li>
<li>Architectures classiques que l’on va retrouver dans de nombreux programmes quel que soit le langage utilisé</li>
<li>Pour résoudre des problèmes courants (par exemple : la conception d’une interface graphique)</li>
</ul>
</div>
<div class="slide section level1">

<h2 id="le-mvc">Le MVC</h2>
<p>Pour Modèle-Vue-Contrôleur ou en anglais Model-View-Controller</p>
<ul>
<li>le problème : la conception d’interface graphique</li>
<li>solution datant de la fin des années 70 avec le développement des premières interfaces graphiques <code>GUI</code> en anglais pour “Graphical User Interface”</li>
<li>a BEAUCOUP évolué, peut s’interpréter de différentes façons et se retrouve à peu près partout sous différentes formes, en particulier dans le développement web et la plupart des <code>framework</code> associés</li>
</ul>
</div>
<div class="slide section level1">

<h2 id="lidée-générale">L’idée générale</h2>
<p>Organiser son architecture et son code en séparant trois rôles :</p>
<ul>
<li>le <strong>modèle</strong> : la logique interne du programme, la gestion des données, les calculs, etc.</li>
<li>la <strong>vue</strong> : l’affichage pour l’utilisateur final, tous les aspects graphiques</li>
<li>le <strong>contrôleur</strong> : la gestion des évènements graphiques lancés par l’utilisateur et le lien entre la vue et le modèle.</li>
</ul>
<p>Pourquoi ? Organisation, modularité, maintenabilité, séparation des compétences et expertises</p>
</div>
<div id="la-preuve-par-lexemple" class="slide section level1">
<h1>La preuve par l’exemple</h1>
<p>Nous allons concevoir une petite application graphique en suivant ce modèle. Cela nous permettra de voir :</p>
<ul>
<li>le fonctionnement général des interfaces <code>Swing</code></li>
<li>comment le design MVC est intégré à <code>Swing</code></li>
<li>un exemple d’architecture MVC basé sur <code>Swing</code></li>
</ul>
<p>Le code final de l’application exemple est <a href="https://github.com/VivianePons/JavaBIBS/tree/main/code/ExempleMVC">disponible ici</a>.</p>
</div>
<div class="slide section level1">

<h2 id="le-modèle">Le modèle</h2>
<p>Le but de l’application est de contrôler le dessin d’un rectangle dans une fenêtre. Le modèle ici est une classe qui représente le rectangle.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> <span class="bu">Rectangle</span> {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a>    </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a>    <span class="kw">public</span> <span class="bu">Rectangle</span>(<span class="dt">int</span> x, <span class="dt">int</span> y, <span class="dt">int</span> width, <span class="dt">int</span> height) {</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a>        <span class="kw">this</span>.<span class="fu">x</span> = x;</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a>        <span class="kw">this</span>.<span class="fu">y</span> = y;</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a>        <span class="kw">this</span>.<span class="fu">width</span> = width;</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a>        <span class="kw">this</span>.<span class="fu">height</span> = height;</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a>    }</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a>    </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true"></a>    ...</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<p>Cette classe contient des champs pour contrôler la position et la taille du rectangle à l’intérieur d’une plus grande boite (gérée avec des paramètres statiques).</p>
<p>Elle contient aussi des méthodes pour déplacer et redimensionner le rectangle tout en vérifiant qu’on reste dans la grande boite.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">trymove</span>(<span class="dt">int</span> diffx, <span class="dt">int</span> diffy) {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a>        <span class="dt">int</span> x = <span class="kw">this</span>.<span class="fu">x</span>;</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>        <span class="dt">int</span> y = <span class="kw">this</span>.<span class="fu">y</span>;</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a>        <span class="kw">this</span>.<span class="fu">x</span> += diffx;</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a>        <span class="kw">this</span>.<span class="fu">y</span> += diffy;</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a>        <span class="kw">if</span>(!<span class="fu">insideBounds</span>()) {</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a>            <span class="kw">this</span>.<span class="fu">x</span> = x;</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a>            <span class="kw">this</span>.<span class="fu">y</span> = y;</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a>            <span class="kw">return</span> <span class="kw">false</span>;</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a>        }</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true"></a>        <span class="kw">return</span> <span class="kw">true</span>;</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true"></a>    }</span></code></pre></div>
</div>
<div class="slide section level1">

<p><strong>Important</strong> : en aucun cas, le modèle ne doit dépendre de l’interface graphique, ni du contrôleur. Il est entièrement indépendant. C’est ce qui assure la modularité : on peut conserver le modèle tel quel si on change d’interface graphique. On peut d’ailleurs avoir plusieurs interfaces graphiques pour un seul modèle.</p>
</div>
<div class="slide section level1">

<h2 id="un-début-dinterface-graphique-pour-notre-modèle">Un début d’interface graphique pour notre modèle</h2>
<h3 id="création-de-linterface">Création de l’interface</h3>
<p>L’objectif est maintenant de construire la “vue” et le “contrôleur” qui vont correspondre à ce modèle.</p>
<p>Pour la vue, on commencer par créer une interface <code>RectangleAppView</code> qui va lister les méthodes spécifiques dont on aura besoin. Cela va permettre de séparer ce qui correspond à <em>notre</em> architecture spécifique et ce qui vient des éléments <code>Swing</code>. On garde ainsi un code plus modulaire.</p>
</div>
<div class="slide section level1">

<div class="sourceCode" id="cb5"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">interface</span> RectangleAppView {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">initialize</span>();</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a>    </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">setRectanle</span>(<span class="bu">Rectangle</span> rectangle);</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a>        </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a>}</span></code></pre></div>
<p>Pour l’instant, l’interface ne contient que 2 méthodes : on l’enrichira au fur et à mesure.</p>
<ul>
<li>l’initialisation : va permettre de lancer l’application</li>
<li>une méthode pour que la vue puisse “voir” le modèle et savoir quoi dessiner.</li>
</ul>
<p>Note : la vue ne doit que “voir” le modèle, elle ne doit pas directement le modifier (ça c’est le rôle du controleur). Pour une meilleure encapsulation, on pourrait donc lui passer seulement un objet qui est capable de “lire” les données mais pas d’écrire.</p>
</div>
<div class="slide section level1">

<h3 id="création-de-la-classe-rectangleappframe">Création de la classe <code>RectangleAppFrame</code></h3>
<p>On va maintenant créer les vrais classes qui vont implémenter notre vue. La classe de la fenêtre principale hérite de <code>JFrame</code> et implémente notre interface.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> RectangleAppFrame <span class="kw">extends</span> <span class="bu">JFrame</span> <span class="kw">implements</span> RectangleAppView {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a>    </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a>    ...</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<p>Que mettre dans cette classe ?</p>
<p>Un constructeur :</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="kw">public</span> <span class="fu">RectangleAppFrame</span>(<span class="bu">String</span> name, <span class="dt">int</span> boundx, <span class="dt">int</span> boundy) {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a>    <span class="kw">super</span>();</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a>    <span class="fu">setTitle</span>(name);</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a>    <span class="fu">setDefaultCloseOperation</span>(<span class="bu">JFrame</span>.<span class="fu">EXIT_ON_CLOSE</span>);</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true"></a>    <span class="kw">this</span>.<span class="fu">setResizable</span>(<span class="kw">false</span>);</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true"></a>    ...</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<h3 id="les-panneaux-jpanel">Les panneaux <code>JPanel</code></h3>
<p>Soit à la création, soit à l’initialisation, il faut créer les composants graphiques.</p>
<p>Une fenêtre <code>Swing</code> est organisée en “panneaux” (classe <code>JPanel</code>). Ces panneaux peuvent contenir d’autres panneaux ainsi que des composants type boutons, texte, etc.</p>
<p>Ici, on va créer deux panneaux : un pour les boutons et les options et un pour dessiner le rectangle.</p>
<p>Le panneau de dessin du rectangle aura des besoins graphiques spécifiques, on va créer une classe qui hérite de <code>JPanel</code>.</p>
</div>
<div class="slide section level1">

<h3 id="la-classe-rectanglepanel">La classe <code>RectanglePanel</code></h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> RectanglePanel <span class="kw">extends</span> <span class="bu">JPanel</span> {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a>    </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a>    <span class="kw">private</span> <span class="bu">Rectangle</span> rectangle;</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true"></a>    <span class="kw">public</span> <span class="fu">RectanglePanel</span>(<span class="dt">int</span> width, <span class="dt">int</span> height) {</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true"></a>        <span class="kw">super</span>();</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true"></a>        <span class="fu">setPreferredSize</span>(<span class="kw">new</span> <span class="bu">Dimension</span>(width, height));</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true"></a>        <span class="fu">setBackground</span>(<span class="bu">Color</span>.<span class="fu">WHITE</span>);</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true"></a>    }</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true"></a>    ...</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true"></a>} </span></code></pre></div>
<p>C’est le panneau du rectangle qui a besoin de voir le modèle donc c’est lui qui stocke le rectangle. A la création, on lui donne la bonne dimension et on passe sa couleur de fond à blanc.</p>
</div>
<div class="slide section level1">

<h3 id="création-des-panneaux">Création des panneaux</h3>
<p>Revenons à <code>RectangleAppFrame</code>. On va stocker deux variables d’instances qui pointent sur les deux panneaux.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> RectangleAppFrame <span class="kw">extends</span> <span class="bu">JFrame</span> <span class="kw">implements</span> RectangleAppView {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a>    </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true"></a>    RectanglePanel rectanglePanel;</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true"></a>    <span class="bu">JPanel</span> buttonPanel;</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true"></a>    </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true"></a>    <span class="kw">public</span> <span class="fu">RectangleAppFrame</span>(<span class="bu">String</span> name, <span class="dt">int</span> boundx, <span class="dt">int</span> boundy) {</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true"></a>        ...</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true"></a>        rectanglePanel = <span class="kw">new</span> <span class="fu">RectanglePanel</span>(boundx, boundy);</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true"></a>        buttonPanel = <span class="kw">new</span> <span class="bu">JPanel</span>();</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true"></a>        buttonPanel.<span class="fu">setPreferredSize</span>(<span class="kw">new</span> <span class="bu">Dimension</span>(<span class="dv">300</span>, boundy));</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true"></a>        <span class="fu">add</span>(rectanglePanel, <span class="bu">BorderLayout</span>.<span class="fu">WEST</span>);</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true"></a>        <span class="fu">add</span>(buttonPanel, <span class="bu">BorderLayout</span>.<span class="fu">EAST</span>);</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true"></a>        <span class="fu">pack</span>();</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true"></a>    }</span></code></pre></div>
<p>On fabrique les panneaux, on donne les bonnes dimensions au panneau des boutons. On ajoute les panneaux à la fenêtre principale (qui contient aussi un panneau). Puis on appelle <code>pack()</code> qui va automatiquement calculer la taille de la fenêtre en fonction de la taille de ses panneaux.</p>
</div>
<div class="slide section level1">

<h3 id="point-info-layout">Point info “layout”</h3>
<p>Le positionnement des composants à l’intérieur d’un panneau est défini par son “layout”. La fenêtre principale possède par défaut un panneau dont le layout est “Border layout” : cela signifie qu’on peut ajouter 5 sous-panneaux (est, ouest, nord, sud et centre). Par défaut, les <code>JPanel</code> utilisent par défaut un layout appelé <code>FlowLayout</code> où les éléments se placent les uns à la suite des autres de façon assez naturelle. Il existe d’autres layout (<code>GridLayout</code>, <code>BoxLayout</code>, etc.).</p>
<p>Je ne vous donne pas des explications détaillées sur le fonctionnement des layout : à vous de chercher et vous renseigner quand vous en aurez besoin.</p>
</div>
<div class="slide section level1">

<h3 id="implémentation-de-linterface-rectangleappview">Implémentation de l’interface <code>RectangleAppView</code></h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> RectangleAppFrame <span class="kw">extends</span> <span class="bu">JFrame</span> <span class="kw">implements</span> RectangleAppView {</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a>    </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a>    ...</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true"></a>    </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">initialize</span>() {</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true"></a>        rectanglePanel.<span class="fu">initialize</span>();</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true"></a>        <span class="fu">setVisible</span>(<span class="kw">true</span>);</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true"></a>    }</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">setRectanle</span>(<span class="bu">Rectangle</span> rectangle) {</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true"></a>        rectanglePanel.<span class="fu">setRectangle</span>(rectangle);</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true"></a>    }</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true"></a>}</span></code></pre></div>
<p>L’initialisation ne fait qu’initialiser le panneau rectangle et rendre la fenêtre visible. La méthode <code>setRectangle</code> délègue au panneau rectangle.</p>
</div>
<div class="slide section level1">

<h3 id="un-contrôleur-pour-lancer-linterface">Un contrôleur pour lancer l’interface</h3>
<p>On crée une classe <code>RectangleController</code></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> RectangleController {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a>    </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">final</span> <span class="dt">int</span> BOUNDX = <span class="dv">500</span>;</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">final</span> <span class="dt">int</span> BOUNDY = <span class="dv">300</span>;</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true"></a>    </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true"></a>    <span class="kw">private</span> <span class="bu">Rectangle</span> rectangle;</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true"></a>    <span class="kw">private</span> RectangleAppView view;</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true"></a>    <span class="kw">public</span> <span class="fu">RectangleController</span>() {</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true"></a>        view = <span class="kw">new</span> <span class="fu">RectangleAppFrame</span>(<span class="st">&quot;My Rectangle app&quot;</span>, BOUNDX, BOUNDY);</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true"></a>    }</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true"></a>    </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">initialize</span>() {</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true"></a>        view.<span class="fu">initialize</span>();</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true"></a>    }</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true"></a>}</span></code></pre></div>
<p>La classe contient un pointeur sur le modèle et un sur la vue. Pour l’instant, elle ne fait que créer la vue.</p>
</div>
<div class="slide section level1">

<h3 id="la-fonction-main">La fonction main</h3>
<p>La fonction <code>main</code> va servir à lancer l’application, ce qui se fait ici en lançant la méthode <code>initialize</code> du contrôleur. On va le faire de cette façon :</p>
<pre><code>SwingUtilities.invokeLater(() -&gt; new RectangleController().initialize());</code></pre>
<p><em>Mais c’est quoi cette façon bizare ?</em> C’est à cause des <em>threads</em>. Pour simplifier, les threads sont les différents sous-programmes de votre programme. Et pour que ça marche bien, le graphique doit être géré dans un thread à part. L’appel à <code>SwingUtilities</code> permet un appel différé par le thread en question. A votre niveau, vous n’avez pas besoin de comprendre le détail. Pour des applications graphiques simples, le <em>multi threading</em> se passe sans que ayez à vous en soucier en dehors de cette ligne d’appel.</p>
</div>
<div class="slide section level1">

<h3 id="quest-ce-que-fait-le-programme">Qu’est-ce que fait le programme ?</h3>
<p>On a maintenant les éléments minimums de la vue et du contrôleur pour lancer notre programme. Pour l’instant, il ne fait qu’ouvrir une fenêtre avec un grand panneau blanc et un plus petit panneau gris. Il n’y a aucun rectangle, c’est pas <em>ultra</em> intéressant…</p>
<p><img src="media/graphique_1.png" alt="Image de la fenêtre obtenue : une fenêtre avec un rectangle blanc et un gris" /><br />
</p>
<p>Mais on y arrive !</p>
</div>
<div class="slide section level1">

<h2 id="créer-et-dessiner-un-rectangle">Créer et dessiner un rectangle</h2>
<p>Le but est de contrôler un rectangle : pour ça il faut qu’on crée et qu’on dessine ce rectangle.</p>
</div>
<div class="slide section level1">

<h3 id="côté-contrôleur">Côté contrôleur</h3>
<p>A l’initialisation du contrôleur, on va créer un nouveau rectangle et le passer à la vue.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">initialize</span>() {</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true"></a>        rectangle = <span class="kw">new</span> <span class="bu">Rectangle</span>(<span class="dv">250</span>, <span class="dv">150</span>, <span class="dv">30</span>, <span class="dv">20</span>);</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true"></a>        rectangle.<span class="fu">setFillColor</span>(<span class="bu">Color</span>.<span class="fu">BLUE</span>);</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true"></a>        view.<span class="fu">setRectanle</span>(rectangle);</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true"></a>        view.<span class="fu">initialize</span>();</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true"></a>    }</span></code></pre></div>
</div>
<div class="slide section level1">

<h3 id="côté-vue">Côté Vue</h3>
<p>Dans la classe <code>RectanglePanel</code>, on va faire en sorte de dessiner le rectangle. Pour cela on surcharge (<em>override</em>) la méthode <code>paintComponent</code> héritée de <code>JPanel</code>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> RectanglePanel <span class="kw">extends</span> <span class="bu">JPanel</span> {</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true"></a>    ...</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true"></a>    </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">paintComponent</span>(<span class="bu">Graphics</span> g) {</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true"></a>        <span class="kw">super</span>.<span class="fu">paintComponent</span>(g);</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true"></a>        <span class="kw">if</span>(rectangle != <span class="kw">null</span>) {</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true"></a>            g.<span class="fu">setColor</span>(rectangle.<span class="fu">getFillColor</span>());</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true"></a>            g.<span class="fu">fillRect</span>(rectangle.<span class="fu">getX</span>(), rectangle.<span class="fu">getY</span>(), rectangle.<span class="fu">getWidth</span>(), rectangle.<span class="fu">getHeight</span>());</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true"></a>        }</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true"></a>    }</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true"></a>    </span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true"></a>    ...</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<h3 id="lancement-de-lapplication">Lancement de l’application</h3>
<p>Maintenant, on voit un rectangle bleu apparaître sur fond blanc quand on lance l’application. (<em>Ouah… Trop beau..</em>)</p>
<p><img src="media/graphique_2.png" alt="Image de la fenêtre obtenue : une fenêtre avec un rectangle gris vide et un rectangle blanc contenant un rectangle bleu" /><br />
</p>
<p>Ca reste assez peu intéressant, comment contrôler le rectangle ?</p>
</div>
<div class="slide section level1">

<h2 id="fabriquer-un-bouton">Fabriquer un bouton</h2>
<p>On va ajouter un bouton pour faire apparaître le rectangle. Tout d’abord, on va créer une interface pour nos boutons toujours dans l’idée de modulariser et de gérer la communication entre la vue et le contrôleur.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">interface</span> RectangleAppActionComponent {</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<p>On crée ensuite une classe <code>RectangleAppButton</code> qui hérite de <code>JButton</code>, le composant bouton de <code>Swing</code> et qui implémente notre interface.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> RectangleAppButton <span class="kw">extends</span> <span class="bu">JButton</span> <span class="kw">implements</span> RectangleAppActionComponent {</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true"></a>    <span class="kw">public</span> <span class="fu">RectangleAppButton</span>(<span class="bu">String</span> name) {</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true"></a>        <span class="kw">super</span>(name);</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true"></a>    }</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<p>A présent, dans <code>RectangleAppFrame</code>, on crée et on ajoute le bouton au panneau des boutons.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> RectangleAppFrame <span class="kw">extends</span> <span class="bu">JFrame</span> <span class="kw">implements</span> RectangleAppView {</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true"></a>    ...</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true"></a>    RectangleAppButton makeRectangleBtn;</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true"></a>    ...</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true"></a>    </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">initialize</span>() {</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true"></a>        makeRectangleBtn = <span class="kw">new</span> <span class="fu">RectangleAppButton</span>(<span class="st">&quot;Create rectangle&quot;</span>);</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true"></a>        buttonPanel.<span class="fu">add</span>(makeRectangleBtn);</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true"></a>        rectanglePanel.<span class="fu">initialize</span>();</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true"></a>        <span class="fu">setVisible</span>(<span class="kw">true</span>);</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true"></a>    }</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<p>L’application ressemble maintenant à ça :</p>
<p><img src="media/graphique_3.png" alt="Image de la fenêtre obtenue : une fenêtre avec un rectangle gris vide contenant un bouton “Create Rectangle” et un rectangle blanc contenant un rectangle bleu" /><br />
</p>
<p>Mais comment faire pour qu’il se passe quelque chose quand on appuie sur le bouton ?</p>
</div>
<div class="slide section level1">

<h2 id="les-évènements-et-les-listeners">Les évènements et les <code>Listeners</code></h2>
<p>Suivant le principe du MVC, <code>Swing</code> sépare l’objet graphique bouton de l’action enclenchée par le clic. Tout le principe de l’interface graphique est basée sur l’idée “d’évènements” qui sont lancés par les composants et “écoutés” par d’autres classes. C’est un framework qui est directement inspiré par la philosophie du MVC et que l’on retrouve, sous une forme ou une autre, dans la plupart des bibliothèques graphiques.</p>
</div>
<div class="slide section level1">

<h3 id="notre-contrôleur-listener">Notre contrôleur listener</h3>
<p>Dans notre application, on va transformer notre contrôleur <code>RectangleController</code> en “écouteur” en ajoutant l’interface <code>ActionListener</code>.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> RectangleController <span class="kw">implements</span> <span class="bu">ActionListener</span> {</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true"></a>    </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true"></a>    ...</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">actionPerformed</span>(<span class="bu">ActionEvent</span> e) {</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true"></a>        <span class="co">// </span><span class="al">TODO</span><span class="co"> Auto-generated method stub</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true"></a>        </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true"></a>    }</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<h3 id="faire-apparaître-le-rectangle-quand-on-clique">Faire apparaître le rectangle quand on clique</h3>
<p>Plutôt que d’ajouter le rectangle à l’initialisation, on va l’ajouter quand la méthode <code>actionPerformed</code> est appelée.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">initialize</span>() {</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true"></a>        view.<span class="fu">initialize</span>();</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true"></a>    }</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">actionPerformed</span>(<span class="bu">ActionEvent</span> e) {</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true"></a>        rectangle = <span class="kw">new</span> <span class="bu">Rectangle</span>(<span class="dv">250</span>, <span class="dv">150</span>, <span class="dv">30</span>, <span class="dv">20</span>);</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true"></a>        rectangle.<span class="fu">setFillColor</span>(<span class="bu">Color</span>.<span class="fu">BLUE</span>);</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true"></a>        view.<span class="fu">setRectanle</span>(rectangle);</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true"></a>    }</span></code></pre></div>
</div>
<div class="slide section level1">

<p>Mais ce n’est pas tout, il faut aussi dire au contrôleur d’écouter le bouton. Pour cela, on ajoute une méthode dans notre interface <code>RectangleAppView</code></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">interface</span> RectangleAppView {</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">initialize</span>();</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true"></a>    </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">setRectanle</span>(<span class="bu">Rectangle</span> rectangle);</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true"></a>    </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">setListenerOnButtons</span>(<span class="bu">ActionListener</span> listener);</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true"></a>    </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<p>Et on l’implémente dans <code>RectangleAppFrame</code></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">setListenerOnButtons</span>(<span class="bu">ActionListener</span> listener) {</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true"></a>        makeRectangleBtn.<span class="fu">addActionListener</span>(listener);</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true"></a>        </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true"></a>    }</span></code></pre></div>
</div>
<div class="slide section level1">

<p>Et on l’appelle dans le contrôleur</p>
<pre><code>    public void initialize() {
        view.initialize();
        view.setListenerOnButtons(this);
    }</code></pre>
</div>
<div class="slide section level1">

<p>Mais ça ne marche toujours pas !! <strong>POURQUOI ?</strong> <em>Désespoir</em></p>
</div>
<div class="slide section level1">

<p>Mais non, il y a une raison simple : la vue ne sait pas que quelque chose a changé, elle a besoin d’être mise à jour.</p>
<p>On rajoute une méthode <code>update</code> dans l’interface et dans la classe :</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">update</span>() {</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true"></a>        rectanglePanel.<span class="fu">repaint</span>();</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true"></a>    }</span></code></pre></div>
<p>La méthode <code>update</code> appelle la méthode <code>repaint</code> du <code>JPanel</code> <code>rectanglePanel</code>.</p>
</div>
<div class="slide section level1">

<p>Et bien sûr, on appelle <code>update</code> depuis le contrôleur.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">actionPerformed</span>(<span class="bu">ActionEvent</span> e) {</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true"></a>        rectangle = <span class="kw">new</span> <span class="bu">Rectangle</span>(<span class="dv">250</span>, <span class="dv">150</span>, <span class="dv">30</span>, <span class="dv">20</span>);</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true"></a>        rectangle.<span class="fu">setFillColor</span>(<span class="bu">Color</span>.<span class="fu">BLUE</span>);</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true"></a>        view.<span class="fu">setRectanle</span>(rectangle);</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true"></a>        view.<span class="fu">update</span>();</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true"></a>    }</span></code></pre></div>
<p>Maintenant, ça marche !</p>
</div>
<div class="slide section level1">

<h2 id="on-fait-un-peu-plus">On fait un peu plus ?</h2>
<p>On va créer un bouton pour faire disparaître le rectangle.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> RectangleAppFrame <span class="kw">extends</span> <span class="bu">JFrame</span> <span class="kw">implements</span> RectangleAppView {</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true"></a>    </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true"></a>    ...</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true"></a>    RectangleAppButton makeRectangleBtn;</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true"></a>    RectangleAppButton deleteRectangleBtn;</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true"></a>    ...</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">initialize</span>() {</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true"></a>        makeRectangleBtn = <span class="kw">new</span> <span class="fu">RectangleAppButton</span>(<span class="st">&quot;Create rectangle&quot;</span>);</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true"></a>        deleteRectangleBtn = <span class="kw">new</span> <span class="fu">RectangleAppButton</span>(<span class="st">&quot;Delete rectangle&quot;</span>);</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true"></a>        buttonPanel.<span class="fu">add</span>(makeRectangleBtn);</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true"></a>        buttonPanel.<span class="fu">add</span>(deleteRectangleBtn);</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true"></a>        ...</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true"></a>    }</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true"></a></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">setListenerOnButtons</span>(<span class="bu">ActionListener</span> listener) {</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true"></a>        makeRectangleBtn.<span class="fu">addActionListener</span>(listener);</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true"></a>        deleteRectangleBtn.<span class="fu">addActionListener</span>(listener);</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true"></a>        </span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true"></a>    }</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true"></a>    ...</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true"></a></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<p>Mais comment faire pour séparer les actions ?</p>
<p>On va créer une liste d’actions différentes avec un <code>enum</code>.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">enum</span> RectangleActions {</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true"></a>    CREATE,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true"></a>    DELETE;</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<p>On va attacher les actions aux boutons. Pour cela, on rajoute des méthodes dans notre interface <code>RectangleAppActionComponent</code> que l’on implémente dans <code>RectangleAppButton</code>.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">interface</span> RectangleAppActionComponent {</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">setRectangleAction</span>(RectangleAction action);</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true"></a>    </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true"></a>    <span class="kw">public</span> RectangleAction <span class="fu">getRectangleAction</span>();</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<p>On attache l’action correspondante à chacun des boutons dans <code>RectangleAppFrame</code></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">initialize</span>() {</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true"></a>        makeRectangleBtn = <span class="kw">new</span> <span class="fu">RectangleAppButton</span>(<span class="st">&quot;Create rectangle&quot;</span>);</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true"></a>        makeRectangleBtn.<span class="fu">setRectangleAction</span>(RectangleAction.<span class="fu">CREATE</span>);</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true"></a>        deleteRectangleBtn = <span class="kw">new</span> <span class="fu">RectangleAppButton</span>(<span class="st">&quot;Delete rectangle&quot;</span>);</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true"></a>        deleteRectangleBtn.<span class="fu">setRectangleAction</span>(RectangleAction.<span class="fu">DELETE</span>);</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true"></a>        buttonPanel.<span class="fu">add</span>(makeRectangleBtn);</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true"></a>        buttonPanel.<span class="fu">add</span>(deleteRectangleBtn);</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true"></a>        rectanglePanel.<span class="fu">initialize</span>();</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true"></a>        <span class="fu">setVisible</span>(<span class="kw">true</span>);</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true"></a>    }</span></code></pre></div>
</div>
<div class="slide section level1">

<p>Le contrôleur récupère l’action reçue (grâce à la méthode <code>getSource</code> de <code>ActionEvent</code>) et agit en conséquence.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">actionPerformed</span>(<span class="bu">ActionEvent</span> e) {</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true"></a>        RectangleAppActionComponent button = (RectangleAppActionComponent) e.<span class="fu">getSource</span>();</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true"></a>        <span class="kw">switch</span>(button.<span class="fu">getRectangleAction</span>()) {</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true"></a>        <span class="kw">case</span> CREATE:</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true"></a>            rectangle = <span class="kw">new</span> <span class="bu">Rectangle</span>(<span class="dv">250</span>, <span class="dv">150</span>, <span class="dv">30</span>, <span class="dv">20</span>);</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true"></a>            rectangle.<span class="fu">setFillColor</span>(<span class="bu">Color</span>.<span class="fu">BLUE</span>);</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true"></a>            view.<span class="fu">setRectanle</span>(rectangle);</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true"></a>            <span class="kw">break</span>;</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true"></a>        <span class="kw">case</span> DELETE:</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true"></a>            rectangle = <span class="kw">null</span>;</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true"></a>            view.<span class="fu">setRectanle</span>(<span class="kw">null</span>);</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true"></a>            <span class="kw">break</span>;</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true"></a>        <span class="kw">default</span>:</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true"></a>            <span class="kw">break</span>;</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true"></a>        </span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true"></a>        }</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true"></a>        view.<span class="fu">update</span>();</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true"></a>    }</span></code></pre></div>
</div>
<div class="slide section level1">

<h2 id="faire-napparaître-que-le-bouton-pertinent">Faire n’apparaître que le bouton pertinent</h2>
<p>Encore une fois, on va essayer de faire ça de façon générique en séparant ce qui relève du contrôleur de ce qui relève de la vue.</p>
<p>Ce qui se passe, c’est qu’on a en fait 2 états possible de la vue : avec et sans rectangle. On va créer les deux méthodes correspondantes dans notre interface <code>RectangleAppView</code></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">interface</span> RectangleAppView {</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true"></a>    ...</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true"></a>    </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">drawNoRectangleView</span>();</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true"></a>    </span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">drawWithRectangleView</span>();</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true"></a>    </span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<p>On les implémente dans <code>RectangleAppFrame</code> en rendant visible / invisible les éléments que l’on souhaite.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">drawNoRectangleView</span>() {</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true"></a>        makeRectangleBtn.<span class="fu">setVisible</span>(<span class="kw">true</span>);</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true"></a>        deleteRectangleBtn.<span class="fu">setVisible</span>(<span class="kw">false</span>);</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true"></a>    }</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">drawWithRectangleView</span>() {</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true"></a>        makeRectangleBtn.<span class="fu">setVisible</span>(<span class="kw">false</span>);</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true"></a>        deleteRectangleBtn.<span class="fu">setVisible</span>(<span class="kw">true</span>);</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true"></a>    }</span></code></pre></div>
</div>
<div class="slide section level1">

<p>Dans le contrôleur, on appelle la méthode appropriée que ce soit à l’intitialisation</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">initialize</span>() {</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true"></a>        view.<span class="fu">initialize</span>();</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true"></a>        view.<span class="fu">drawNoRectangleView</span>();</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true"></a>        view.<span class="fu">setListenerOnButtons</span>(<span class="kw">this</span>);</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true"></a>    }</span></code></pre></div>
</div>
<div class="slide section level1">

<p>Que lors d’un évènement</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">actionPerformed</span>(<span class="bu">ActionEvent</span> e) {</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true"></a>        RectangleAppActionComponent button = (RectangleAppActionComponent) e.<span class="fu">getSource</span>();</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true"></a>        <span class="kw">switch</span>(button.<span class="fu">getRectangleAction</span>()) {</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true"></a>        <span class="kw">case</span> CREATE:</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true"></a>            rectangle = <span class="kw">new</span> <span class="bu">Rectangle</span>(<span class="dv">250</span>, <span class="dv">150</span>, <span class="dv">30</span>, <span class="dv">20</span>);</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true"></a>            rectangle.<span class="fu">setFillColor</span>(<span class="bu">Color</span>.<span class="fu">BLUE</span>);</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true"></a>            view.<span class="fu">setRectanle</span>(rectangle);</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true"></a>            view.<span class="fu">drawWithRectangleView</span>();</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true"></a>            <span class="kw">break</span>;</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true"></a>        <span class="kw">case</span> DELETE:</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true"></a>            rectangle = <span class="kw">null</span>;</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true"></a>            view.<span class="fu">setRectanle</span>(<span class="kw">null</span>);</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true"></a>            view.<span class="fu">drawNoRectangleView</span>();</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true"></a>            <span class="kw">break</span>;</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true"></a>        <span class="kw">default</span>:</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true"></a>            <span class="kw">break</span>;</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true"></a>        </span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true"></a>        }</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true"></a>        view.<span class="fu">update</span>();</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true"></a>    }</span></code></pre></div>
</div>
<div class="slide section level1">

<h2 id="on-rajoute-plein-de-boutons">On rajoute plein de boutons :</h2>
<p>De la même façon, on peut rajouter des boutons correspondants à toutes les actions suivantes :</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">enum</span> RectangleAction {</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true"></a>    CREATE,</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true"></a>    DELETE,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true"></a>    MOVE_LEFT,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true"></a>    MOVE_RIGHT,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true"></a>    MOVE_UP,</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true"></a>    MOVE_DOWN,</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true"></a>    INCREASE_WIDTH,</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true"></a>    DECREASE_WIDTH,</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true"></a>    INCREASE_HEIGHT,</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true"></a>    DECREASE_HEIGHT</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<h2 id="contrôle-au-clavier">Contrôle au clavier</h2>
<p>On peut ajouter des “écouteurs” pour d’autres actions, par exemple un <code>KeyListener</code> pour les touches du clavier. On implémente l’interface avec</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> RectangleController <span class="kw">implements</span> <span class="bu">ActionListener</span>, <span class="bu">KeyListener</span> {</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true"></a>    ...</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true"></a>    </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">keyTyped</span>(<span class="bu">KeyEvent</span> e) {</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true"></a>        <span class="co">// </span><span class="al">TODO</span><span class="co"> Auto-generated method stub</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true"></a>        </span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true"></a>    }</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true"></a></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">keyPressed</span>(<span class="bu">KeyEvent</span> e) {</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true"></a>        <span class="co">// </span><span class="al">TODO</span><span class="co"> Auto-generated method stub</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true"></a>        </span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true"></a>    }</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true"></a></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">keyReleased</span>(<span class="bu">KeyEvent</span> e) {</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true"></a>        <span class="co">// </span><span class="al">TODO</span><span class="co"> Auto-generated method stub</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true"></a>        </span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true"></a>    }</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<p>Voilà une implémentation possible de la méthode <code>keyPressed</code></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true"></a><span class="at">@Override</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">keyPressed</span>(<span class="bu">KeyEvent</span> e) {</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true"></a>        <span class="kw">switch</span>(e.<span class="fu">getKeyCode</span>()) {</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true"></a>        <span class="kw">case</span> <span class="bu">KeyEvent</span>.<span class="fu">VK_LEFT</span>:</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true"></a>            rectangle.<span class="fu">trymove</span>(-<span class="dv">1</span>, <span class="dv">0</span>);</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true"></a>            <span class="kw">break</span>;</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true"></a>        <span class="kw">case</span> <span class="bu">KeyEvent</span>.<span class="fu">VK_RIGHT</span>:</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true"></a>            rectangle.<span class="fu">trymove</span>(<span class="dv">1</span>, <span class="dv">0</span>);</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true"></a>            <span class="kw">break</span>;</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true"></a>        <span class="kw">case</span> <span class="bu">KeyEvent</span>.<span class="fu">VK_UP</span>:</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true"></a>            rectangle.<span class="fu">trymove</span>(<span class="dv">0</span>, -<span class="dv">1</span>);</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true"></a>            <span class="kw">break</span>;</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true"></a>        <span class="kw">case</span> <span class="bu">KeyEvent</span>.<span class="fu">VK_DOWN</span>:</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true"></a>            rectangle.<span class="fu">trymove</span>(<span class="dv">0</span>, <span class="dv">1</span>);</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true"></a>            <span class="kw">break</span>;</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true"></a>        <span class="kw">case</span> <span class="bu">KeyEvent</span>.<span class="fu">VK_C</span>:</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true"></a>            rectangle.<span class="fu">tryExtendWidth</span>(-<span class="dv">1</span>);</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true"></a>            <span class="kw">break</span>;</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true"></a>        <span class="kw">case</span> <span class="bu">KeyEvent</span>.<span class="fu">VK_V</span>:</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true"></a>            rectangle.<span class="fu">tryExtendWidth</span>(<span class="dv">1</span>);</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true"></a>            <span class="kw">break</span>;</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true"></a>        <span class="kw">case</span> <span class="bu">KeyEvent</span>.<span class="fu">VK_B</span>:</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true"></a>            rectangle.<span class="fu">tryExtendHeight</span>(-<span class="dv">1</span>);</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true"></a>            <span class="kw">break</span>;</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true"></a>        <span class="kw">case</span> <span class="bu">KeyEvent</span>.<span class="fu">VK_N</span>:</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true"></a>            rectangle.<span class="fu">tryExtendHeight</span>(<span class="dv">1</span>);</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true"></a>            <span class="kw">break</span>;</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true"></a>        }</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true"></a>        view.<span class="fu">update</span>();</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true"></a>    }</span></code></pre></div>
</div>
<div class="slide section level1">

<p>Il faut ensuite ajouter les méthodes et appels nécessaires pour que le contrôleur soit bien ajouté comme écouteur des actions clavier de la fenêtre principale.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">interface</span> RectangleAppView {</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true"></a>    ...</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true"></a>    </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">startKeyListener</span>(<span class="bu">KeyListener</span> listener);</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true"></a>    </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">stopKeyListener</span>(<span class="bu">KeyListener</span> listener);</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true"></a>    </span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true"></a>    ...</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true"></a>    </span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<p>Comme on utilise à la fois des boutons et le clavier, il faut faire un peu attention car l’écoute du clavier que si le “focus” est sur le bon objet.</p>
<p>On doit spécifier que la fenêtre est “focusable”</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> RectangleAppFrame <span class="kw">extends</span> <span class="bu">JFrame</span> <span class="kw">implements</span> RectangleAppView {</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true"></a>    </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true"></a>    ...</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true"></a>    </span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true"></a>    <span class="kw">public</span> <span class="fu">RectangleAppFrame</span>(<span class="bu">String</span> name, <span class="dt">int</span> boundx, <span class="dt">int</span> boundy) {</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true"></a>        <span class="kw">super</span>();</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true"></a>        <span class="fu">setTitle</span>(name);</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true"></a>        <span class="fu">setDefaultCloseOperation</span>(<span class="bu">JFrame</span>.<span class="fu">EXIT_ON_CLOSE</span>);</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true"></a>        <span class="kw">this</span>.<span class="fu">setFocusable</span>(<span class="kw">true</span>);</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true"></a>        ...</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true"></a>        </span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true"></a>    }</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true"></a>    </span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true"></a>    ...</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<p>On récupère le focus à chaque fois qu’on active l’écoute clavier</p>
<pre><code>public class RectangleAppFrame extends JFrame implements RectangleAppView {

    ...

    @Override
    public void startKeyListener(KeyListener listener) {
        addKeyListener(listener);
        requestFocus();
    }
    
    @Override
    public void stopKeyListener(KeyListener listener) {
        removeKeyListener(listener);
    }
    
    ...
}</code></pre>
</div>
<div class="slide section level1">

<p>Côté contrôleur, on relance l’écoute du clavier après chaque action de bouton :</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">actionPerformed</span>(<span class="bu">ActionEvent</span> e) {</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true"></a>        <span class="kw">if</span>(rectangle != <span class="kw">null</span>) {</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true"></a>            view.<span class="fu">stopKeyListener</span>(<span class="kw">this</span>);</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true"></a>        }</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true"></a>        <span class="kw">switch</span>(button.<span class="fu">getRectangleAction</span>()) {</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true"></a>        <span class="kw">case</span> CREATE:</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true"></a>            rectangle = <span class="kw">new</span> <span class="bu">Rectangle</span>(<span class="dv">250</span>, <span class="dv">150</span>, <span class="dv">30</span>, <span class="dv">20</span>);</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true"></a>            rectangle.<span class="fu">setFillColor</span>(<span class="bu">Color</span>.<span class="fu">BLUE</span>);</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true"></a>            view.<span class="fu">setRectanle</span>(rectangle);</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true"></a>            view.<span class="fu">drawWithRectangleView</span>();</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true"></a>            mouseListener = <span class="kw">new</span> <span class="fu">ControllerMouseMotionListener</span>();</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true"></a>            <span class="kw">break</span>;</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true"></a>        <span class="kw">case</span> DELETE:</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true"></a>            rectangle = <span class="kw">null</span>;</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true"></a>            view.<span class="fu">setRectanle</span>(<span class="kw">null</span>);</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true"></a>            view.<span class="fu">drawNoRectangleView</span>();</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true"></a>            <span class="kw">break</span>;</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true"></a>        ...</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true"></a>        </span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true"></a>        }</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true"></a>        <span class="kw">if</span>(rectangle != <span class="kw">null</span>) {</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true"></a>            view.<span class="fu">startKeyListener</span>(<span class="kw">this</span>);</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true"></a>        }</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true"></a>        view.<span class="fu">update</span>();</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true"></a>    }</span></code></pre></div>
</div>
<div class="slide section level1">

<h2 id="contrôle-de-la-souris">Contrôle de la souris</h2>
<p>On veut pouvoir déplacer le rectangle à la souris. Le <em>listener</em> qui correspond à cette action est le <code>MouseMotionListener</code>. On ajoute des méthodes à notre vue :</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">interface</span> RectangleAppView {</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true"></a>    ...</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true"></a>    </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">startMouseMotionListener</span>(<span class="bu">MouseMotionListener</span> listener);</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true"></a>    </span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">stopMouseMotionListener</span>(<span class="bu">MouseMotionListener</span> listener);</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true"></a>    </span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true"></a>    ...</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true"></a>    </span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div class="slide section level1">

<h3 id="implémentation-côté-vue">Implémentation côté vue</h3>
<p>Dans <code>RectangleAppFrame</code>, on délègue en réalité cette action au panneau sur lequel est dessiné le rectangle. Ainsi, la position renvoyée par la souris correspondra bien à la position théorique dans le modèle.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">startMouseMotionListener</span>(<span class="bu">MouseMotionListener</span> listener) {</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true"></a>        rectanglePanel.<span class="fu">addMouseMotionListener</span>(listener);</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true"></a>        </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true"></a>    }</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">stopMouseMotionListener</span>(<span class="bu">MouseMotionListener</span> listener) {</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true"></a>        rectanglePanel.<span class="fu">removeMouseMotionListener</span>(listener);</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true"></a>        </span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true"></a>    }</span></code></pre></div>
</div>
<div class="slide section level1">

<h3 id="implantation-côté-contrôleur">Implantation côté contrôleur</h3>
<p>La gestion du mouvement de la souris va demander un peu de logique interne. Pour ne pas mélanger cette logique avec celle du contrôleur général, on va créer une nouvelle classe dédiée spécifiquement à l’écoute de la souris.</p>
<p>On veut que l’objet créé ait accès à tous les paramètres internes du contôleur et par ailleurs, cette classe ne sera utilisée que à l’intérieur d’une instance du contrôleur : la solution est de passer par une classe interne.</p>
</div>
<div class="slide section level1">

<h3 id="point-info-classe-interne">Point info : classe interne</h3>
<p>Les classes internes sont utilisées exactement pour répondre au problème qu’on vient d’énoncer :</p>
<ul>
<li>besoin d’une logique spécifique ou d’un objet spécifique</li>
<li>besoin d’accéder aux champs et méthodes de l’instance</li>
<li>utilisation uniquement au sein de la classe en question</li>
</ul>
<p>Il y a parfois des petites subtilités techniques mais globalement, leur utilisation est assez naturelle. Comme on les voit très souvent dans le contexte des interfaces graphiques (où il faut tout le temps créer des listeners), je vous montre cet exemple là.</p>
</div>
<div class="slide section level1">

<h3 id="la-classe-interne">La classe interne</h3>
<div class="sourceCode" id="cb43"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> RectangleController <span class="kw">implements</span> <span class="bu">ActionListener</span>, <span class="bu">KeyListener</span> {</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true"></a>    ...</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true"></a>    </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true"></a>    <span class="kw">private</span> <span class="kw">class</span> ControllerMouseMotionListener <span class="kw">implements</span> <span class="bu">MouseMotionListener</span> {</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true"></a>        <span class="kw">private</span> <span class="dt">boolean</span> startDrag;</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true"></a>        <span class="kw">private</span> <span class="dt">int</span> prevx;</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true"></a>        <span class="kw">private</span> <span class="dt">int</span> prevy;</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true"></a>        </span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true"></a>        <span class="fu">ControllerMouseMotionListener</span>() {</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true"></a>            startDrag = <span class="kw">false</span>;</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true"></a>        }</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true"></a>        </span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true"></a>        <span class="at">@Override</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true"></a>        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">mouseDragged</span>(<span class="bu">MouseEvent</span> e) {</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true"></a>            </span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true"></a>            <span class="kw">if</span>(! startDrag) {</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true"></a>                <span class="dt">int</span> x = e.<span class="fu">getX</span>();</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true"></a>                <span class="dt">int</span> y = e.<span class="fu">getY</span>();</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true"></a>                <span class="kw">if</span>(rectangle.<span class="fu">insideRectanle</span>(x, y)) {</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true"></a>                    startDrag = <span class="kw">true</span>;</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true"></a>                    prevx = x;</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true"></a>                    prevy = y;</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true"></a>                }</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true"></a>            } <span class="kw">else</span> {</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true"></a>                <span class="dt">int</span> diffx = e.<span class="fu">getX</span>() - prevx;</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true"></a>                <span class="dt">int</span> diffy = e.<span class="fu">getY</span>() - prevy;</span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true"></a>                rectangle.<span class="fu">trymove</span>(diffx, diffy);</span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true"></a>                prevx = e.<span class="fu">getX</span>();</span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true"></a>                prevy = e.<span class="fu">getY</span>();</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true"></a>                view.<span class="fu">update</span>();</span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true"></a>            }</span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true"></a>            </span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true"></a>        }</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true"></a></span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true"></a>        <span class="at">@Override</span></span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true"></a>        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">mouseMoved</span>(<span class="bu">MouseEvent</span> e) {</span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true"></a>            startDrag = <span class="kw">false</span>;</span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true"></a>            </span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true"></a>        }</span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true"></a>        </span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true"></a>    }</span></code></pre></div>
</div>
<div class="slide section level1">

<h3 id="on-en-parle-pas-mais-ça-existe">On en parle pas mais ça existe</h3>
<p>Scoop: en fait, on aurait même pu faire ce qui s’appelle une “classe anonyme” mais j’ai préféré ne pas vous embrouiller surtout que ça rend le code peu lisible.</p>
<p>Cependant, si vous parcourez des exemples de code d’interface graphique en java, vous en verrez sûrement et dans ce cas, pas de panique : cherchez un peu plus d’info, ce n’est pas plus compliqué que les classes internes.</p>
</div>
<div class="slide section level1">

<h3 id="le-reste-de-limplémentation-côté-contrôleur">Le reste de l’implémentation côté contrôleur</h3>
<div class="sourceCode" id="cb44"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true"></a><span class="kw">public</span> <span class="kw">class</span> RectangleController <span class="kw">implements</span> <span class="bu">ActionListener</span>, <span class="bu">KeyListener</span> {</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true"></a>    </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true"></a>    ...</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true"></a>    </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true"></a>    <span class="kw">private</span> ControllerMouseMotionListener mouseListener;</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true"></a>    <span class="at">@Override</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">actionPerformed</span>(<span class="bu">ActionEvent</span> e) {</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true"></a>        ...</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true"></a>        <span class="kw">switch</span>(button.<span class="fu">getRectangleAction</span>()) {</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true"></a>        <span class="kw">case</span> CREATE:</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true"></a>            rectangle = <span class="kw">new</span> <span class="bu">Rectangle</span>(<span class="dv">250</span>, <span class="dv">150</span>, <span class="dv">30</span>, <span class="dv">20</span>);</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true"></a>            rectangle.<span class="fu">setFillColor</span>(<span class="bu">Color</span>.<span class="fu">BLUE</span>);</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true"></a>            view.<span class="fu">setRectanle</span>(rectangle);</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true"></a>            view.<span class="fu">drawWithRectangleView</span>();</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true"></a>            mouseListener = <span class="kw">new</span> <span class="fu">ControllerMouseMotionListener</span>();</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true"></a>            view.<span class="fu">startMouseMotionListener</span>(mouseListener);</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true"></a>            <span class="kw">break</span>;</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true"></a>        <span class="kw">case</span> DELETE:</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true"></a>            rectangle = <span class="kw">null</span>;</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true"></a>            view.<span class="fu">setRectanle</span>(<span class="kw">null</span>);</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true"></a>            view.<span class="fu">drawNoRectangleView</span>();</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true"></a>            view.<span class="fu">stopMouseMotionListener</span>(mouseListener);</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true"></a>            <span class="kw">break</span>;</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true"></a>        ...</span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true"></a>        }</span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true"></a>        ...</span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true"></a>    }</span></code></pre></div>
</div>
<div id="en-conclusion" class="slide section level1">
<h1>En conclusion</h1>
<p>Ceci, n’est <strong>qu’un exemple</strong> d’une architecture possible. Une partie de la séparation entre contrôle et vue est déjà assurée par <code>Swing</code> en séparant les composants des <code>listener</code>. Dans notre architecture :</p>
</div>
<div class="slide section level1">

<h2 id="le-rôle-de-la-vue">Le rôle de la vue</h2>
<p>Dans notre architecture :</p>
<ul>
<li>la vue s’occupe de qui dessiner où et pendant quelle phase de l’application</li>
<li>quand la vue reçoit une demande d’écoute par le contrôleur, elle s’occupe de qui doit être écouté (les boutons, le panneau, la fenêtre)</li>
<li>la vue s’occupe de se mettre à jour sur demande en fonction de ce qu’elle voit du modèle</li>
</ul>
</div>
<div class="slide section level1">

<h2 id="le-rôle-du-contrôleur">Le rôle du contrôleur</h2>
<p>Dans notre architecture :</p>
<ul>
<li>le contrôleur s’occupe de modifier le modèle</li>
<li>le contrôleur s’occupe de lancer les différentes phases</li>
<li>le contrôleur s’occupe de quand commencer / arrêter d’écouter</li>
<li>le contrôleur s’occupe de réagir aux actions de l’utilisateur remontées par la vue (par le biais des listeners)</li>
<li>le contrôleur ne s’occupe <strong>pas</strong> de quels sont les composants qu’il écoute, ni même de quel type ils sont (il y a plusieurs sortes de boutons), il s’occupe simplement des évènements qui lui arrive</li>
</ul>
</div>
<div class="slide section level1">

<h2 id="les-limites">les limites</h2>
<p>L’implantation du contrôleur est très dépendante de l’architecture de <code>Swing</code>. Quand le contrôleur a plus de travail que lancer une action de base sur le modèle, on va vouloir séparer la partie plus “haut niveau”, de la partie “bas niveau” (les listeners) qui est dépendante de la bibliothèque graphique.</p>
<p>La partie bas niveau du contrôleur peut même être assimilée à la vue mais elle doit garder un moyen d’envoyer les évènements au contrôleur.</p>
<p>Ce qu’il faut garder à l’esprit : c’est une philosophie générale qu’il faut essayer d’adapter à bon escient. Le principe est de séparer les rôles.</p>
</div>
</body>
</html>
